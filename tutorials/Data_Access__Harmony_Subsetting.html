<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.2.232">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>data_access__harmony_subsetting</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/bootstrap/bootstrap-dark.min.css">
  <script id="quarto-search-options" type="application/json">{
    "location": "sidebar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "start",
    "type": "textbox",
    "limit": 20
  }</script>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">(Untitled)</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto docked overflow-auto">
  <div class="px-3 pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
    <img src="https://user-images.githubusercontent.com/2915555/133525653-2a2278b1-1015-4350-b2a5-160d125aaaf7.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">2021 Cloud Hackathon</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/nasa-openscapes/2021-Cloud-Hackathon" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
  </div>
    <div class="px-3 mt-2 flex-shrink-0 align-items-center">
      <div class="sidebar-search">
      <div id="quarto-search" class="mb-0 " title="Search">
</div>
      </div>
    </div>
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-1 px-3">
      <li class="sidebar-item">
  <a href="../index.html" class="">Welcome</a>
</li>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="../logistics/index.html" class="">Logistics</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#logistics-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="logistics-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../logistics/schedule.html" class="">Schedule</a>
</li>
          <li class="sidebar-item">
  <a href="../logistics/prerequisites.html" class="">Prerequisites, setup, &amp; getting help</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="../clinic/index.html" class="">Pre-Hackathon Clinic</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#pre-hackathonclinic-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="pre-hackathonclinic-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../clinic/jupyterhub.html" class="">NASA Openscapes Cloud Environment</a>
</li>
          <li class="sidebar-item">
  <a href="../clinic/notebooks.html" class="">Notebooks, Python, Git</a>
</li>
          <li class="sidebar-item">
  <a href="../clinic/github.html" class="">GitHub</a>
</li>
          <li class="sidebar-item">
  <a href="../clinic/earthdata.html" class="">Earthdata Login</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="../tutorials/index.html" class="">Tutorials</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#tutorials-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="tutorials-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../tutorials/00_Setup.html" class="">00. Setup for tutorials</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/01_Data_Discovery_CMR.html" class="">01. Data discovery with CMR</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/02_Data_Discovery_CMR-STAC_API.html" class="">02. Data Discovery with CMR-STAC API</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/03_Xarray.html" class="">03. Introduction to <code>xarray</code></a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/04_NASA_Earthdata_Authentication.html" class="">04. Authentication for NASA Earthdata</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/05_Data_Access_Direct_S3.html" class="">05. Direct S3 Data Access</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/06_S6_OPeNDAP_Access_Gridding.html" class="">06. Sentinel-6 MF L2 Altimetry Data Access (OPeNDAP) &amp; Gridding</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/07_Data_Access_Harmony_Subsetting.html" class="">Data Subsetting and Transformation Services in the Cloud</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/08_Data_Access_Harmonize-cloud-non-cloud.html" class="">Harmonizing data located within and outside of the NASA Earthdata Cloud</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/09_Zarr_Access.html" class="">09. Zarr Access for NetCDF4 files</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <li class="sidebar-item">
  <a href="../tutorials-templates/index.html" class="">Tutorial Templates</a>
</li>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="../projects/index.html" class="">Projects</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#projects-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="projects-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../projects/workflow.html" class="">Collaborative workflow</a>
</li>
          <li class="sidebar-item">
  <a href="../projects/hackathon-projects.html" class="">Hackathon Projects</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#additionalresources-collapse" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Additional Resources</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="additionalresources-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../tutorials/Additional_Resources__Data_Access__Direct_S3_Access__PODAAC_ECCO_SSH.html" class="">Direct S3 Data Access - Rough PODAAC ECCO SSH Example</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/Additional_Resources__Direct_S3_Access__gdalvrt.html" class="">Direct S3 Data Access with GDAL Virtual Raster Format (VRT)</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/Additional_Resources__Direct_S3_Access__rioxarray_clipping.html" class="">Direct S3 Data Access</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class=" pt-0 col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#data-subsetting-and-transformation-services-in-the-cloud" class="nav-link active" data-scroll-target="#data-subsetting-and-transformation-services-in-the-cloud">Data Subsetting and Transformation Services in the Cloud</a>
<ul class="collapse">
<li><a href="#using-the-harmony-py-library-to-access-customized-data-from-nasa-earthdata" class="nav-link" data-scroll-target="#using-the-harmony-py-library-to-access-customized-data-from-nasa-earthdata">Using the Harmony-Py library to access customized data from NASA Earthdata</a></li>
<li><a href="#summary" class="nav-link" data-scroll-target="#summary">Summary</a>
<ul class="collapse">
<li><a href="#objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a></li>
</ul></li>
<li><a href="#import-packages" class="nav-link" data-scroll-target="#import-packages">Import Packages</a></li>
<li><a href="#discover-service-options-for-a-given-data-set" class="nav-link" data-scroll-target="#discover-service-options-for-a-given-data-set">Discover service options for a given data set</a></li>
<li><a href="#discover-variable-names" class="nav-link" data-scroll-target="#discover-variable-names">Discover variable names</a></li>
<li><a href="#harmony-py-set-up" class="nav-link" data-scroll-target="#harmony-py-set-up">Harmony-Py set up</a>
<ul class="collapse">
<li><a href="#create-harmony-client-object" class="nav-link" data-scroll-target="#create-harmony-client-object">Create Harmony Client object</a></li>
<li><a href="#create-harmony-request" class="nav-link" data-scroll-target="#create-harmony-request">Create Harmony Request</a></li>
<li><a href="#check-request-validity" class="nav-link" data-scroll-target="#check-request-validity">Check Request validity</a></li>
<li><a href="#submit-request" class="nav-link" data-scroll-target="#submit-request">Submit request</a></li>
<li><a href="#check-request-status" class="nav-link" data-scroll-target="#check-request-status">Check request status</a></li>
<li><a href="#view-harmony-job-response-and-output-urls" class="nav-link" data-scroll-target="#view-harmony-job-response-and-output-urls">View Harmony job response and output URLs</a></li>
<li><a href="#direct-cloud-access" class="nav-link" data-scroll-target="#direct-cloud-access">Direct cloud access</a></li>
<li><a href="#open-staged-files-with-s3fs-and-xarray" class="nav-link" data-scroll-target="#open-staged-files-with-s3fs-and-xarray">Open staged files with <em>s3fs</em> and <em>xarray</em></a></li>
<li><a href="#note-ideally-wed-show-how-to-bring-in-all-files-into-a-single-xarray-ds-but-im-getting-an-error" class="nav-link" data-scroll-target="#note-ideally-wed-show-how-to-bring-in-all-files-into-a-single-xarray-ds-but-im-getting-an-error">**Note, Ideally, we’d show how to bring in all files into a single xarray ds but I’m getting an error:</a></li>
<li><a href="#plot-the-data" class="nav-link" data-scroll-target="#plot-the-data">Plot the data</a></li>
<li><a href="#extra-code-attempting-to-read-in-directly-from-s3-into-xarray" class="nav-link" data-scroll-target="#extra-code-attempting-to-read-in-directly-from-s3-into-xarray">Extra code attempting to read in directly from s3 into xarray:</a></li>
</ul></li>
<li><a href="#resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/nasa-openscapes/2021-Cloud-Hackathon/edit/main/tutorials/Data_Access__Harmony_Subsetting.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/nasa-openscapes/2021-Cloud-Hackathon/issues/new" class="toc-action">Report an issue</a></p></div></div></nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 col-xl-7 px-lg-4 pe-xxl-4 ps-xxl-0">
<main>

<section id="data-subsetting-and-transformation-services-in-the-cloud" class="level1">
<h1>Data Subsetting and Transformation Services in the Cloud</h1>
<section id="using-the-harmony-py-library-to-access-customized-data-from-nasa-earthdata" class="level2">
<h2 class="anchored" data-anchor-id="using-the-harmony-py-library-to-access-customized-data-from-nasa-earthdata">Using the Harmony-Py library to access customized data from NASA Earthdata</h2>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Harmony allows you to seamlessly analyze Earth observation data from different NASA data centers… https://harmony.earthdata.nasa.gov/</p>
<section id="benefits" class="level4">
<h4 class="anchored" data-anchor-id="benefits">Benefits</h4>
<ul>
<li>Consistent access patterns to EOSDIS holdings make cross-data center data access easier</li>
<li>Data reduction services allow users to request only the data they want, in the format and projection they want</li>
<li>Analysis Ready Data and cloud access will help reduce time-to-science</li>
<li>Community Development helps reduce the barriers for re-use of code and sharing of domain knowledge</li>
</ul>
<p>Harmony-Py is a Python library for integrating with NASA’s Harmony Services.</p>
<p>Harmony-Py provides a Python alternative to directly using Harmony’s RESTful API. It handles NASA Earthdata Login (EDL) authentication and optionally integrates with the CMR Python Wrapper by accepting collection results as a request parameter. It’s convenient for scientists who wish to use Harmony from Jupyter notebooks as well as machine-to-machine communication with larger Python applications.</p>
</section>
<section id="objectives" class="level3">
<h3 class="anchored" data-anchor-id="objectives">Objectives</h3>
<ol type="1">
<li>Practice skills learned from intro to CMR tutorial to discover what access and service options exist for a given data set</li>
<li><hr></li>
</ol>
</section>
</section>
<section id="import-packages" class="level2">
<h2 class="anchored" data-anchor-id="import-packages">Import Packages</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> harmony <span class="im">import</span> BBox, Client, Collection, Request, LinkType</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> harmony.config <span class="im">import</span> Environment</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime <span class="im">as</span> dt</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> s3fs</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="discover-service-options-for-a-given-data-set" class="level2">
<h2 class="anchored" data-anchor-id="discover-service-options-for-a-given-data-set">Discover service options for a given data set</h2>
<ul>
<li><p>First, what do we mean by a “service”? [TODO] Describe how we define services and their benefits, and how not all datasets have services on them due to level of support, etc….</p></li>
<li><p>Let’s see what the collection metadata tells us</p></li>
</ul>
<p>Building off of CMR introduction tutorial:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>cmr_search_url <span class="op">=</span> <span class="st">'https://cmr.earthdata.nasa.gov/search'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We want to search by collection to inspect the access and service options that exist:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>cmr_collection_url <span class="op">=</span> <span class="ss">f'</span><span class="sc">{</span>cmr_search_url<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span><span class="st">"collections"</span><span class="sc">}</span><span class="ss">'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the CMR introduction tutorial, we explored cloud-hosted collections from different DAAC providers, and identified the CMR <code>concept-id</code> for a given data set id (also referred to as a <code>short_name</code>).</p>
<p>Here we are jumping ahead and already know the <code>concept_id</code> we are interested in, by browsing cloud-hosted datasets from PO.DAAC in Earthdata Search: https://search.earthdata.nasa.gov/portal/podaac-cloud/search.</p>
<p>We are going to focus on <code>MODIS_A-JPL-L2P-v2019.0</code>: GHRSST Level 2P Global Sea Surface Skin Temperature from the Moderate Resolution Imaging Spectroradiometer (MODIS) on the NASA Aqua satellite (GDS2). Let’s first save this as a variable that we can use later on once we request data from Harmony.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>short_name<span class="op">=</span> <span class="st">'MODIS_A-JPL-L2P-v2019.0'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>concept_id <span class="op">=</span> <span class="st">'C1940473819-POCLOUD'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We will view the top-level metadata for this collection to see what additional service and variable metadata exist.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(cmr_collection_url, </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                        params<span class="op">=</span>{</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'concept_id'</span>: concept_id,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>                            },</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                        headers<span class="op">=</span>{</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'Accept'</span>: <span class="st">'application/json'</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>                            }</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                       )</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> response.json()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Print the response:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pprint(response)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{'feed': {'entry': [{'archive_center': 'NASA/JPL/PODAAC',
                     'associations': {'services': ['S1962070864-POCLOUD',
                                                   'S2004184019-POCLOUD'],
                                      'tools': ['TL2108419875-POCLOUD',
                                                'TL2092786348-POCLOUD'],
                                      'variables': ['V1997812737-POCLOUD',
                                                    'V1997812697-POCLOUD',
                                                    'V2112014688-POCLOUD',
                                                    'V1997812756-POCLOUD',
                                                    'V1997812688-POCLOUD',
                                                    'V1997812670-POCLOUD',
                                                    'V1997812724-POCLOUD',
                                                    'V2112014684-POCLOUD',
                                                    'V1997812701-POCLOUD',
                                                    'V1997812681-POCLOUD',
                                                    'V2112014686-POCLOUD',
                                                    'V1997812663-POCLOUD',
                                                    'V1997812676-POCLOUD',
                                                    'V1997812744-POCLOUD',
                                                    'V1997812714-POCLOUD']},
                     'boxes': ['-90 -180 90 180'],
                     'browse_flag': True,
                     'collection_data_type': 'SCIENCE_QUALITY',
                     'coordinate_system': 'CARTESIAN',
                     'data_center': 'POCLOUD',
                     'dataset_id': 'GHRSST Level 2P Global Sea Surface Skin '
                                   'Temperature from the Moderate Resolution '
                                   'Imaging Spectroradiometer (MODIS) on the '
                                   'NASA Aqua satellite (GDS2)',
                     'has_formats': True,
                     'has_spatial_subsetting': True,
                     'has_temporal_subsetting': True,
                     'has_transforms': False,
                     'has_variables': True,
                     'id': 'C1940473819-POCLOUD',
                     'links': [{'href': 'https://podaac.jpl.nasa.gov/Podaac/thumbnails/MODIS_A-JPL-L2P-v2019.0.jpg',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/browse#'},
                               {'href': 'https://github.com/podaac/data-readers',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://podaac-tools.jpl.nasa.gov/drive/files/OceanTemperature/ghrsst/docs/GDS20r5.pdf',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://ghrsst.jpl.nasa.gov',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://oceancolor.gsfc.nasa.gov/atbd/sst/flag/',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://oceancolor.gsfc.nasa.gov/reprocessing/r2019/sst/',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://oceancolor.gsfc.nasa.gov/atbd/sst4/',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://modis.gsfc.nasa.gov/data/atbd/atbd_mod25.pdf',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://oceancolor.gsfc.nasa.gov/atbd/sst/',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'http://www.ghrsst.org',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://podaac.jpl.nasa.gov/forum/viewforum.php?f=18&amp;sid=e2d67e5a01815fc6e39fcd2087ed8bc8',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://podaac.jpl.nasa.gov/CitingPODAAC',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://cmr.earthdata.nasa.gov/virtual-directory/collections/C1940473819-POCLOUD',
                                'hreflang': 'en-US',
                                'length': '75.0MB',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/data#'},
                               {'href': 'https://github.com/podaac/tutorials/blob/master/notebooks/MODIS_L2P_SST_DataCube.ipynb',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/documentation#'},
                               {'href': 'https://search.earthdata.nasa.gov/search/granules?p=C1940473819-POCLOUD',
                                'hreflang': 'en-US',
                                'rel': 'http://esipfed.org/ns/fedsearch/1.1/data#'}],
                     'online_access_flag': True,
                     'orbit_parameters': {'inclination_angle': '98.1',
                                          'number_of_orbits': '1.0',
                                          'period': '98.4',
                                          'swath_width': '2330.0'},
                     'organizations': ['NASA/JPL/PODAAC'],
                     'original_format': 'UMM_JSON',
                     'platforms': ['Aqua'],
                     'processing_level_id': '2',
                     'service_features': {'esi': {'has_formats': False,
                                                  'has_spatial_subsetting': False,
                                                  'has_temporal_subsetting': False,
                                                  'has_transforms': False,
                                                  'has_variables': False},
                                          'harmony': {'has_formats': True,
                                                      'has_spatial_subsetting': True,
                                                      'has_temporal_subsetting': True,
                                                      'has_transforms': False,
                                                      'has_variables': True},
                                          'opendap': {'has_formats': True,
                                                      'has_spatial_subsetting': True,
                                                      'has_temporal_subsetting': True,
                                                      'has_transforms': False,
                                                      'has_variables': True}},
                     'short_name': 'MODIS_A-JPL-L2P-v2019.0',
                     'summary': 'NASA produces skin sea surface temperature '
                                '(SST) products from the Infrared (IR) '
                                'channels of the Moderate-resolution Imaging '
                                'Spectroradiometer (MODIS) onboard the Aqua '
                                'satellite. Aqua was launched by NASA on May '
                                '4, 2002, into a sun synchronous, polar orbit '
                                'with a daylight ascending node at 1:30 pm, '
                                'formation flying in the A-train with other '
                                'Earth Observation Satellites (EOS), to study '
                                'the global dynamics of the Earth atmosphere, '
                                'land and oceans. MODIS captures data in 36 '
                                'spectral bands at a variety of spatial '
                                'resolutions.  Two SST products can be present '
                                'in these files. The first is a skin SST '
                                'produced for both day and night (NSST) '
                                'observations, derived from the long wave IR '
                                '11 and 12 micron wavelength channels, using a '
                                'modified nonlinear SST algorithm intended to '
                                'provide continuity of SST derived from '
                                'heritage and current NASA sensors. At night, '
                                'a second SST product is generated using the '
                                'mid-infrared 3.95 and 4.05 micron  wavelength '
                                'channels which are unique to MODIS; the SST '
                                'derived from these measurements is identified '
                                'as SST4. The SST4 product has lower '
                                'uncertainty, but due to sun glint can only be '
                                'used at night. MODIS L2P SST data have a 1 km '
                                'spatial resolution at nadir and are stored in '
                                '288 five minute granules per day. Full global '
                                'coverage is obtained every two days, with '
                                'coverage poleward of 32.3 degree being '
                                'complete each day.  The production of MODIS '
                                'L2P SST files is part of the Group for High '
                                'Resolution Sea Surface Temperature (GHRSST) '
                                'project and is a joint collaboration between '
                                'the NASA Jet Propulsion Laboratory (JPL), the '
                                'NASA Ocean Biology Processing Group (OBPG), '
                                'and the Rosenstiel School of Marine and '
                                'Atmospheric Science (RSMAS). Researchers at '
                                'RSMAS are responsible for SST algorithm '
                                'development, error statistics and quality '
                                'flagging, while the OBPG, as the NASA ground '
                                'data system, is responsible for the '
                                'production of daily MODIS ocean products. JPL '
                                'acquires MODIS ocean granules from the OBPG '
                                'and reformats them to the GHRSST L2P netCDF '
                                'specification with complete metadata and '
                                'ancillary variables, and distributes the data '
                                'as the official Physical Oceanography Data '
                                'Archive (PO.DAAC) for SST.  The R2019.0 '
                                'supersedes the previous R2014.0 datasets '
                                'which can be found at '
                                'https://doi.org/10.5067/GHMDA-2PJ02',
                     'time_start': '2002-07-04T00:00:00.000Z',
                     'title': 'GHRSST Level 2P Global Sea Surface Skin '
                              'Temperature from the Moderate Resolution '
                              'Imaging Spectroradiometer (MODIS) on the NASA '
                              'Aqua satellite (GDS2)',
                     'updated': '2019-12-02T22:59:24.849Z',
                     'version_id': '2019.0'}],
          'id': 'https://cmr.earthdata.nasa.gov:443/search/collections.json?concept_id=C1940473819-POCLOUD',
          'title': 'ECHO dataset metadata',
          'updated': '2021-11-11T04:20:20.527Z'}}</code></pre>
</div>
</div>
<p>Let’s walk through what each of these service values mean:</p>
<ul>
<li>Associations
<ul>
<li>CMR is a large web of interconnected metadata “schemas”, including Collections, Granules, Services, Tools, and Variables. In this case, this collection is associated with two unique services, two tools, and several unique variables.</li>
</ul></li>
<li>Tags
<ul>
<li>There are also tags that describe what service options exist at a high-level. In this case, we see that this dataset supports the ability to reformat, subset by space and time, as well as by variable. This is used in web applications like Earthdata Search to surface those customization options more readily.</li>
</ul></li>
<li>Service Features
<ul>
<li>In this case, we see three separate “features” listed here: esi, Harmony, and OPeNDAP.</li>
</ul></li>
</ul>
<p>We will dig into more details on what Harmony offers for this dataset.</p>
<p>First, we need to isolate the services returned for this dataset:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode" id="cb8"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>services <span class="op">=</span> response[<span class="st">'feed'</span>][<span class="st">'entry'</span>][<span class="dv">0</span>][<span class="st">'associations'</span>][<span class="st">'services'</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(services)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>['S1962070864-POCLOUD', 'S2004184019-POCLOUD']</code></pre>
</div>
</div>
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>cmr_service_url <span class="op">=</span> <span class="st">"https://cmr.earthdata.nasa.gov/search/services"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Inspect the first service returned. Now we’re going to search the services endpoint to view that individual service’s metadata, like we did with our dataset above.</p>
<p>TODO: Explain why we need the output format in umm_json</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>output_format <span class="op">=</span> <span class="st">"umm_json"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>service_response <span class="op">=</span> requests.get(<span class="ss">f"</span><span class="sc">{</span>cmr_service_url<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>output_format<span class="sc">}</span><span class="ss">?concept-id=</span><span class="sc">{</span>services[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="11">
<div class="sourceCode" id="cb13"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pprint(service_response.json())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{'hits': 1,
 'items': [{'meta': {'concept-id': 'S1962070864-POCLOUD',
                     'concept-type': 'service',
                     'deleted': False,
                     'format': 'application/vnd.nasa.cmr.umm+json',
                     'native-id': 'POCLOUD_podaac_l2_cloud_subsetter',
                     'provider-id': 'POCLOUD',
                     'revision-date': '2021-11-02T22:57:03.597Z',
                     'revision-id': 19,
                     'user-id': 'podaaccloud'},
            'umm': {'AccessConstraints': 'None',
                    'Description': 'Endpoint for subsetting L2 Subsetter via '
                                   'Harmony',
                    'LongName': 'PODAAC Level 2 Cloud Subsetter',
                    'MetadataSpecification': {'Name': 'UMM-S',
                                              'URL': 'https://cdn.earthdata.nasa.gov/umm/service/v1.4',
                                              'Version': '1.4'},
                    'Name': 'PODAAC L2 Cloud Subsetter',
                    'OperationMetadata': [{'OperationName': 'SPATIAL_SUBSETTING'},
                                          {'OperationName': 'VARIABLE_SUBSETTING'},
                                          {'OperationName': 'TEMPORAL_SUBSETTING'}],
                    'ServiceKeywords': [{'ServiceCategory': 'EARTH SCIENCE '
                                                            'SERVICES',
                                         'ServiceTerm': 'SUBSETTING/SUPERSETTING',
                                         'ServiceTopic': 'DATA MANAGEMENT/DATA '
                                                         'HANDLING'}],
                    'ServiceOptions': {'Subset': {'SpatialSubset': {'BoundingBox': {'AllowMultipleValues': False}},
                                                  'TemporalSubset': {'AllowMultipleValues': False},
                                                  'VariableSubset': {'AllowMultipleValues': True}},
                                       'SupportedReformattings': [{'SupportedInputFormat': 'HDF5',
                                                                   'SupportedOutputFormats': ['NETCDF-4']},
                                                                  {'SupportedInputFormat': 'NETCDF-4',
                                                                   'SupportedOutputFormats': ['NETCDF-4']}]},
                    'ServiceOrganizations': [{'LongName': 'Physical '
                                                          'Oceanography '
                                                          'Distributed Active '
                                                          'Archive Center, Jet '
                                                          'Propulsion '
                                                          'Laboratory, NASA',
                                              'Roles': ['ORIGINATOR'],
                                              'ShortName': 'NASA/JPL/PODAAC'}],
                    'Type': 'Harmony',
                    'URL': {'Description': 'PROJECT HOME PAGE',
                            'URLValue': 'https://harmony.earthdata.nasa.gov'},
                    'Version': '1.1.0'}}],
 'took': 21}</code></pre>
</div>
</div>
<p>TODO: Describe these different service options and broader Harmony / backend subsetter context.</p>
</section>
<section id="discover-variable-names" class="level2">
<h2 class="anchored" data-anchor-id="discover-variable-names">Discover variable names</h2>
<p>TODO: Could this be an “exercise” to gain more familiarity with CMR?</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode" id="cb15"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> response[<span class="st">'feed'</span>][<span class="st">'entry'</span>][<span class="dv">0</span>][<span class="st">'associations'</span>][<span class="st">'variables'</span>]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(variables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>['V1997812737-POCLOUD', 'V1997812697-POCLOUD', 'V2112014688-POCLOUD', 'V1997812756-POCLOUD', 'V1997812688-POCLOUD', 'V1997812670-POCLOUD', 'V1997812724-POCLOUD', 'V2112014684-POCLOUD', 'V1997812701-POCLOUD', 'V1997812681-POCLOUD', 'V2112014686-POCLOUD', 'V1997812663-POCLOUD', 'V1997812676-POCLOUD', 'V1997812744-POCLOUD', 'V1997812714-POCLOUD']</code></pre>
</div>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cmr_var_url <span class="op">=</span> <span class="st">"https://cmr.earthdata.nasa.gov/search/variables"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>var_response <span class="op">=</span> requests.get(<span class="ss">f"</span><span class="sc">{</span>cmr_var_url<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>output_format<span class="sc">}</span><span class="ss">?concept-id=</span><span class="sc">{</span>variables[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="15">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>pprint(var_response.json())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{'hits': 1,
 'items': [{'associations': {'collections': [{'concept-id': 'C1940473819-POCLOUD'}]},
            'meta': {'concept-id': 'V1997812737-POCLOUD',
                     'concept-type': 'variable',
                     'deleted': False,
                     'format': 'application/vnd.nasa.cmr.umm+json',
                     'native-id': 'MODIS_A-JPL-L2P-v2019.0-sses_standard_deviation_4um',
                     'provider-id': 'POCLOUD',
                     'revision-date': '2021-10-19T02:26:51.560Z',
                     'revision-id': 6,
                     'user-id': 'jmcnelis'},
            'umm': {'DataType': 'byte',
                    'Definition': 'mid-IR SST standard deviation error; non '
                                  'L2P core field; signed byte array:  WARNING '
                                  'Some applications are unable to properly '
                                  'handle signed byte values. If values are '
                                  'encountered &gt; 127, please subtract 256 from '
                                  'this reported value',
                    'Dimensions': [{'Name': 'time',
                                    'Size': 1,
                                    'Type': 'TIME_DIMENSION'},
                                   {'Name': 'nj',
                                    'Size': 2030,
                                    'Type': 'ALONG_TRACK_DIMENSION'},
                                   {'Name': 'ni',
                                    'Size': 1354,
                                    'Type': 'CROSS_TRACK_DIMENSION'}],
                    'FillValues': [{'Type': 'SCIENCE_FILLVALUE',
                                    'Value': -128}],
                    'LongName': 'SSES standard deviation error based on '
                                'proximity confidence flags',
                    'Name': 'sses_standard_deviation_4um',
                    'Offset': 10.0,
                    'Scale': 0.07874016,
                    'Sets': [{'Index': 1,
                              'Name': 'sses_standard_deviation_4um',
                              'Size': 1,
                              'Type': 'General'}],
                    'Units': 'kelvin',
                    'ValidRanges': [{'Max': 127, 'Min': -127}],
                    'VariableType': 'ANCILLARY_VARIABLE'}}],
 'took': 109}</code></pre>
</div>
</div>
<p>Let’s print out a simple list of all associated variable names.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>var_list <span class="op">=</span> []</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(variables)):</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(<span class="ss">f"</span><span class="sc">{</span>cmr_var_url<span class="sc">}</span><span class="ss">.</span><span class="sc">{</span>output_format<span class="sc">}</span><span class="ss">?concept-id=</span><span class="sc">{</span>variables[i]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> response.json()</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    var_list.append(response[<span class="st">'items'</span>][<span class="dv">0</span>][<span class="st">'umm'</span>][<span class="st">'Name'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="17">
<div class="sourceCode" id="cb22"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>pprint(var_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>['sses_standard_deviation_4um',
 'l2p_flags',
 'time',
 'dt_analysis',
 'sses_standard_deviation',
 'sst_dtime',
 'sses_bias_4um',
 'lat',
 'sea_surface_temperature_4um',
 'sses_bias',
 'lon',
 'sea_surface_temperature',
 'quality_level',
 'wind_speed',
 'quality_level_4um']</code></pre>
</div>
</div>
</section>
<section id="harmony-py-set-up" class="level2">
<h2 class="anchored" data-anchor-id="harmony-py-set-up">Harmony-Py set up</h2>
<p>[TODO] Describe Harmony-Py in more detail (connection between the library and the API).</p>
<p>Next steps adopted from the intro tutorial notebook in the Harmony-Py library: https://github.com/nasa/harmony-py/blob/main/examples/intro_tutorial.ipynb</p>
<section id="create-harmony-client-object" class="level3">
<h3 class="anchored" data-anchor-id="create-harmony-client-object">Create Harmony Client object</h3>
<p>First, we need to create a Harmony Client, which is what we will interact with to submit and inspect a data request to Harmony, as well as to retrieve results.</p>
<p>When creating the Client, we need to provide Earthdata Login credentials, which are required to access data from NASA EOSDIS. This basic line below assumes that we have a <code>.netrc</code> available.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>harmony_client <span class="op">=</span> Client()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="create-harmony-request" class="level3">
<h3 class="anchored" data-anchor-id="create-harmony-request">Create Harmony Request</h3>
<p>The following are common request parameters:</p>
<ul>
<li><code>collection</code>: Required parameter. This is the NASA EOSDIS collection, or data product. There are two options for inputting a collection of interest:
<ul>
<li>Provide a concept ID, which is an ID provided in the Common Metadata Repository (CMR) metadata</li>
<li>Data product short name (e.g.&nbsp;SENTINEL-1_INTERFEROGRAMS).</li>
</ul></li>
<li><code>spatial</code>: Bounding box spatial constraints on the data. The Harmony Bbox class accepts spatial coordinates as decimal degrees in w, s, e, n order, where longitude = -180, 180 and latitude = -90, 90.</li>
<li><code>temporal</code>: Date/time constraints on the data. The example below demonstrates temporal start and end ranges using the python datetime library.</li>
</ul>
<p>Other advanced parameters that may be of interest. Note that many reformatting or advanced projection options may not be available for your requested dataset. See the <a href="https://harmony-py.readthedocs.io/en/latest/">documentation</a> for details on how to construct these parameters.</p>
<p>[TODO] Describe area/time use case with this dataset - maybe demonstrating Earthdata Search for browsing??</p>
<p>We will search over the Gulf of Mexico during the period 1 Aug 2020 to 1 Nov 2020, since we are interested in exploring how SST responds during the latest Atlantic hurricane season.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>request <span class="op">=</span> Request(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    collection<span class="op">=</span>Collection(<span class="bu">id</span><span class="op">=</span>short_name),</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    spatial=BBox(60,-45.75,90,-45), # bounding box example that can be used as an alternative to shapefile input</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    spatial<span class="op">=</span>BBox(<span class="op">-</span><span class="fl">97.77667</span>,<span class="fl">21.20806</span>,<span class="op">-</span><span class="fl">83.05197</span>,<span class="fl">30.16605</span>), <span class="co"># bounding box example that can be used as an alternative to shapefile input</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    temporal<span class="op">=</span>{</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'start': dt.datetime(2021, 11, 1),</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'stop': dt.datetime(2021, 11, 2),</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'start'</span>: dt.datetime(<span class="dv">2021</span>, <span class="dv">8</span>, <span class="dv">1</span>),</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'stop'</span>: dt.datetime(<span class="dv">2021</span>, <span class="dv">8</span>, <span class="dv">2</span>),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># variables=variables,</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="check-request-validity" class="level3">
<h3 class="anchored" data-anchor-id="check-request-validity">Check Request validity</h3>
<p>Before submitting a Harmony Request, we can test your request to see if it’s valid and how to fix it if not. In particular, <code>request.is_valid</code> will check to ensure that the spatial BBox bounds and temporal ranges are entered correctly.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode" id="cb26"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>request.is_valid()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="25">
<pre><code>True</code></pre>
</div>
</div>
</section>
<section id="submit-request" class="level3">
<h3 class="anchored" data-anchor-id="submit-request">Submit request</h3>
<p>Now that the request is created, we can now submit it to Harmony using the Harmony Client object. A job id is returned, which is a unique identifier that represents the submitted request.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode" id="cb28"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>job_id <span class="op">=</span> harmony_client.submit(request)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>job_id</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="26">
<pre><code>'9979fa59-f3e9-4ac9-b8c1-2888bc736258'</code></pre>
</div>
</div>
</section>
<section id="check-request-status" class="level3">
<h3 class="anchored" data-anchor-id="check-request-status">Check request status</h3>
<p>We can check on the progress of a processing job with status(). This method blocks while communicating with the server but returns quickly.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode" id="cb30"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>harmony_client.status(job_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="27">
<pre><code>{'status': 'running',
 'message': 'There were 2 collections that matched the provided short name MODIS_A-JPL-L2P-v2019.0. See https://cmr.earthdata.nasa.gov/concepts/C1940473819-POCLOUD for details on the selected collection. The version ID for the selected collection is 2019.0. To use a different collection submit a new request specifying the desired CMR concept ID instead of the collection short name.',
 'progress': 0,
 'created_at': datetime.datetime(2021, 11, 11, 4, 23, 47, 746000, tzinfo=tzlocal()),
 'updated_at': datetime.datetime(2021, 11, 11, 4, 23, 47, 746000, tzinfo=tzlocal()),
 'request': 'https://harmony.earthdata.nasa.gov/MODIS_A-JPL-L2P-v2019.0/ogc-api-coverages/1.0.0/collections/all/coverage/rangeset?forceAsync=true&amp;subset=lat(21.20806%3A30.16605)&amp;subset=lon(-97.77667%3A-83.05197)&amp;subset=time(%222021-08-01T00%3A00%3A00%22%3A%222021-08-02T00%3A00%3A00%22)',
 'num_input_granules': 6}</code></pre>
</div>
</div>
<p>Depending on the size of the request, it may be helpful to wait until the request has completed processing before the remainder of the code is executed. The wait_for_processing() method will block subsequent lines of code while optionally showing a progress bar.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode" id="cb32"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>harmony_client.wait_for_processing(job_id, show_progress<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code> [ Processing: 100% ] |###################################################| [|]</code></pre>
</div>
</div>
</section>
<section id="view-harmony-job-response-and-output-urls" class="level3">
<h3 class="anchored" data-anchor-id="view-harmony-job-response-and-output-urls">View Harmony job response and output URLs</h3>
<p>Once the data request has finished processing, we can view details on the job that was submitted to Harmony, including the API call to Harmony, and informational messages on the request if available.</p>
<p>result_json() calls wait_for_processing() and returns the complete job in JSON format once processing is complete.</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode" id="cb34"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> harmony_client.result_json(job_id)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>pprint(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>{'createdAt': '2021-11-11T04:23:47.746Z',
 'jobID': '9979fa59-f3e9-4ac9-b8c1-2888bc736258',
 'links': [{'href': 'https://harmony.earthdata.nasa.gov/stac/9979fa59-f3e9-4ac9-b8c1-2888bc736258/',
            'rel': 'stac-catalog-json',
            'title': 'STAC catalog',
            'type': 'application/json'},
           {'bbox': [-95.851, 29.339, -62.863, 50.743],
            'href': 'https://harmony.earthdata.nasa.gov/service-results/harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801072501-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0.nc4',
            'rel': 'data',
            'temporal': {'end': '2021-08-01T07:29:58.000Z',
                         'start': '2021-08-01T07:25:01.000Z'},
            'title': '20210801072501-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0.nc4',
            'type': 'application/x-netcdf4'},
           {'bbox': [-97.5, 21.2, -83.1, 30.2],
            'href': 'https://harmony.earthdata.nasa.gov/service-results/harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801073001-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0_subsetted.nc4',
            'rel': 'data',
            'temporal': {'end': '2021-08-01T07:34:58.000Z',
                         'start': '2021-08-01T07:30:01.000Z'},
            'title': '20210801073001-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0_subsetted.nc4',
            'type': 'application/x-netcdf4'},
           {'bbox': [-97.8, 25.9, -96.2, 30.2],
            'href': 'https://harmony.earthdata.nasa.gov/service-results/harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801090501-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0_subsetted.nc4',
            'rel': 'data',
            'temporal': {'end': '2021-08-01T09:09:58.000Z',
                         'start': '2021-08-01T09:05:01.000Z'},
            'title': '20210801090501-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0_subsetted.nc4',
            'type': 'application/x-netcdf4'},
           {'bbox': [-90.2, 21.2, -83.1, 29.8],
            'href': 'https://harmony.earthdata.nasa.gov/service-results/harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801182501-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4',
            'rel': 'data',
            'temporal': {'end': '2021-08-01T18:29:58.000Z',
                         'start': '2021-08-01T18:25:01.000Z'},
            'title': '20210801182501-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4',
            'type': 'application/x-netcdf4'},
           {'bbox': [-90.9, 28.3, -83.1, 30.2],
            'href': 'https://harmony.earthdata.nasa.gov/service-results/harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801183001-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4',
            'rel': 'data',
            'temporal': {'end': '2021-08-01T18:34:58.000Z',
                         'start': '2021-08-01T18:30:01.000Z'},
            'title': '20210801183001-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4',
            'type': 'application/x-netcdf4'},
           {'bbox': [-97.8, 21.2, -89.5, 30.2],
            'href': 'https://harmony.earthdata.nasa.gov/service-results/harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801200501-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4',
            'rel': 'data',
            'temporal': {'end': '2021-08-01T20:09:58.000Z',
                         'start': '2021-08-01T20:05:01.000Z'},
            'title': '20210801200501-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4',
            'type': 'application/x-netcdf4'},
           {'href': 'https://harmony.earthdata.nasa.gov/jobs/9979fa59-f3e9-4ac9-b8c1-2888bc736258?linktype=https&amp;page=1&amp;limit=2000',
            'rel': 'self',
            'title': 'The current page',
            'type': 'application/json'}],
 'message': 'There were 2 collections that matched the provided short name '
            'MODIS_A-JPL-L2P-v2019.0. See '
            'https://cmr.earthdata.nasa.gov/concepts/C1940473819-POCLOUD for '
            'details on the selected collection. The version ID for the '
            'selected collection is 2019.0. To use a different collection '
            'submit a new request specifying the desired CMR concept ID '
            'instead of the collection short name.',
 'numInputGranules': 6,
 'progress': 100,
 'request': 'https://harmony.earthdata.nasa.gov/MODIS_A-JPL-L2P-v2019.0/ogc-api-coverages/1.0.0/collections/all/coverage/rangeset?forceAsync=true&amp;subset=lat(21.20806%3A30.16605)&amp;subset=lon(-97.77667%3A-83.05197)&amp;subset=time(%222021-08-01T00%3A00%3A00%22%3A%222021-08-02T00%3A00%3A00%22)',
 'status': 'successful',
 'updatedAt': '2021-11-11T04:24:25.421Z',
 'username': 'amy.steiker'}</code></pre>
</div>
</div>
</section>
<section id="direct-cloud-access" class="level3">
<h3 class="anchored" data-anchor-id="direct-cloud-access">Direct cloud access</h3>
<p>Note that the remainder of this tutorial will only succeed when running this notebook within the AWS us-west-2 region.</p>
<p>Harmony data outputs can be accessed within the cloud using the s3 URLs and AWS credentials provided in the Harmony job response.</p>
<section id="retrieve-list-of-output-urls." class="level4">
<h4 class="anchored" data-anchor-id="retrieve-list-of-output-urls.">Retrieve list of output URLs.</h4>
<p>The result_urls() method calls wait_for_processing() and returns a list of the processed data URLs once processing is complete. You may optionally show the progress bar as shown below.</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode" id="cb36"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>results <span class="op">=</span> harmony_client.result_urls(job_id, link_type<span class="op">=</span>LinkType.s3)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>urls <span class="op">=</span> <span class="bu">list</span>(results)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>pprint(urls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>['s3://harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801072501-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0.nc4',
 's3://harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801073001-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0_subsetted.nc4',
 's3://harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801090501-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0_subsetted.nc4',
 's3://harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801182501-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4',
 's3://harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801183001-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4',
 's3://harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801200501-JPL-L2P_GHRSST-SSTskin-MODIS_A-D-v02.0-fv01.0_subsetted.nc4']</code></pre>
</div>
</div>
<p>We can see that the first file returned does not include the <code>_subsetted</code> suffix, which indicates that a blank file was returned, as no data values were located within our subsetted region. We’ll select the second URL in the list to bring into xarray below.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode" id="cb38"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> urls[<span class="dv">1</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>url</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="35">
<pre><code>'s3://harmony-prod-staging/public/podaac/l2-subsetter/b081caea-4c8c-4118-b613-e8688b16140c/20210801073001-JPL-L2P_GHRSST-SSTskin-MODIS_A-N-v02.0-fv01.0_subsetted.nc4'</code></pre>
</div>
</div>
</section>
<section id="aws-credential-retrieval" class="level4">
<h4 class="anchored" data-anchor-id="aws-credential-retrieval">AWS credential retrieval</h4>
<p>Using aws_credentials you can retrieve the credentials needed to access the Harmony s3 staging bucket and its contents.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>creds <span class="op">=</span> harmony_client.aws_credentials()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="open-staged-files-with-s3fs-and-xarray" class="level3">
<h3 class="anchored" data-anchor-id="open-staged-files-with-s3fs-and-xarray">Open staged files with <em>s3fs</em> and <em>xarray</em></h3>
<p>We use the AWS <code>s3fs</code> package to create a file system that can then be read by xarray:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>s3_fs <span class="op">=</span> s3fs.S3FileSystem(</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    key<span class="op">=</span>creds[<span class="st">'aws_access_key_id'</span>],</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    secret<span class="op">=</span>creds[<span class="st">'aws_secret_access_key'</span>],</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    token<span class="op">=</span>creds[<span class="st">'aws_session_token'</span>],</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    client_kwargs<span class="op">=</span>{<span class="st">'region_name'</span>:<span class="st">'us-west-2'</span>},</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="note-ideally-wed-show-how-to-bring-in-all-files-into-a-single-xarray-ds-but-im-getting-an-error" class="level3">
<h3 class="anchored" data-anchor-id="note-ideally-wed-show-how-to-bring-in-all-files-into-a-single-xarray-ds-but-im-getting-an-error">**Note, Ideally, we’d show how to bring in all files into a single xarray ds but I’m getting an error:</h3>
<div class="sourceCode" id="cb42"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Iterate through remote_files to create a fileset</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fileset = [s3_fs.open(file) for file in urls]</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fileset</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ds = xr.open_mfdataset(fileset)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that we have our s3 file system set, including our declared credentials, we’ll use that to open the url, and read in the file through xarray:</p>
<div class="cell" data-execution_count="40">
<div class="sourceCode" id="cb43"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> s3_fs.<span class="bu">open</span>(url, mode<span class="op">=</span><span class="st">'rb'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ds = xr.open_dataset(f, decode_cf=False)</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> xr.open_dataset(f)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>ds.sea_surface_temperature.plot()</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>f.close()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Data_Access__Harmony_Subsetting_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="plot-the-data" class="level3">
<h3 class="anchored" data-anchor-id="plot-the-data">Plot the data</h3>
<div class="sourceCode" id="cb44"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # Determine the lat/lon coordinate names</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for coord_name, coord in ds.coords.items():</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     if 'units' not in coord.attrs:</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co">#         continue</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     if coord.attrs['units'] == 'degrees_north':</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="co">#         lat_var = coord_name</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     if coord.attrs['units'] == 'degrees_east':</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co">#         lon_var = coord_name</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f'lat_var={lat_var}')</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># print(f'lon_var={lon_var}')</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co"># # if ds[variable].size == 0:</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co"># #     print("No data in subsetted region. Exiting")</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co"># #     sys.exit(0)</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co"># import matplotlib.pyplot as plt</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co"># import math</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="co"># fig, axes = plt.subplots(ncols=3, nrows=math.ceil((len(ds.data_vars)/3)))</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="co"># fig.set_size_inches((15,15))</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a><span class="co"># for count, xvar in enumerate(ds.data_vars):</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     if  ds[xvar].dtype == "timedelta64[ns]":</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a><span class="co">#         continue</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="co">#         #ds[xvar].astype('timedelta64[D]').plot(ax=axes[int(count/3)][count%3])</span></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     ds[xvar].plot(ax=axes[int(count/3)][count%3])</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="extra-code-attempting-to-read-in-directly-from-s3-into-xarray" class="level3">
<h3 class="anchored" data-anchor-id="extra-code-attempting-to-read-in-directly-from-s3-into-xarray">Extra code attempting to read in directly from s3 into xarray:</h3>
<div class="sourceCode" id="cb45"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># netcdf_stores = [netcdf_fs.get_mapper(root=u, check=False) for u in urls]</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># netcdf_stores</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># xr.open_mfdataset(netcdf_stores)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<p>https://github.com/podaac/tutorials/blob/master/notebooks/SWOT-EA-2021/Colocate_satellite_insitu_ocean.ipynb</p>


</section>
</section>
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('div.sidebar-toc .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('.quarto-toc-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      return window.localStorage.getItem("quarto-color-scheme");
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = null;
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.id = "quarto-color-scheme-toggle";
    a.classList.add('top-right');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    window.tippy(el, {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    }); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
  </div>
  <div class="nav-page nav-page-next">
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
<div class="row">
  <div class="nav-footer">
      <div class="nav-footer-center me-auto ms-auto">PODAAC, NSIDC DAAC and LPDAAC (2021). 2021 Cloud Hackathon</div>
  </div>
</div>
</div> <!-- /container fluid -->


</body></html>