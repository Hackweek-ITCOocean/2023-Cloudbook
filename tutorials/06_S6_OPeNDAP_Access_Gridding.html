<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.2.232">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>s6_opendap_access_gridding</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <script src="../site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="../site_libs/quarto-nav/headroom.min.js"></script>
  <script src="../site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="../">
  <script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="../site_libs/quarto-search/fuse.min.js"></script>
  <script src="../site_libs/quarto-search/quarto-search.js"></script>
  <link href="../tutorials/07_Data_Access_Harmony_Subsetting.html" rel="next">
  <link href="../tutorials/05_Data_Access_Direct_S3.html" rel="prev">
  <script src="../site_libs/quarto-html/quarto.js"></script>
  <script src="../site_libs/quarto-html/popper.min.js"></script>
  <script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="../site_libs/quarto-html/anchor.min.js"></script>
  <link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css">
  <script src="../site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link class="quarto-color-scheme" href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link class="quarto-color-scheme quarto-color-alternate" rel="prefetch" href="../site_libs/bootstrap/bootstrap-dark.min.css">
  <script id="quarto-search-options" type="application/json">{
    "location": "sidebar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "start",
    "type": "textbox",
    "limit": 20
  }</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
  <link rel="stylesheet" href="../styles.css">
</head>
<body>
<div id="quarto-search-results"></div>
<header id="quarto-header" class="headroom fixed-top">
<nav class="quarto-secondary-nav py-2 d-lg-none d-md-block " data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <div class="container-fluid d-flex justify-content-between">
    <h1 class="quarto-secondary-nav-title mb-0 fs-3 d-inline">(Untitled)</h1>
    <button type="button" class="quarto-btn-toggle btn d-lg-none py-0 px-1 d-inline-block border-0 ">
      <i class="bi bi-chevron-right"></i>
    </button>
  </div>
</nav>
</header>
 <!-- /navbar/sidebar -->
<div class="container-fluid quarto-container d-flex flex-column page-layout-article">
<div class="row flex-fill" id="quarto-content">
  <div id="quarto-sidebar" class="col col-12 col-lg-3 d-lg-flex px-0 pt-0 sidebar collapse sidebar-navigation">
    <nav class="me-lg-auto docked overflow-auto">
  <div class="px-3 pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
    <img src="https://user-images.githubusercontent.com/2915555/133525653-2a2278b1-1015-4350-b2a5-160d125aaaf7.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">2021 Cloud Hackathon</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/nasa-openscapes/2021-Cloud-Hackathon" title="" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
  </div>
    <div class="px-3 mt-2 flex-shrink-0 align-items-center">
      <div class="sidebar-search">
      <div id="quarto-search" class="mb-0 " title="Search">
</div>
      </div>
    </div>
  <div class="sidebar-menu-container"> 
  <ul class="list-unstyled mt-1 px-3">
      <li class="sidebar-item">
  <a href="../index.html" class="">Welcome</a>
</li>
      <li class="sidebar-item">
  <a href="../cloud-paradigm.html" class="">Cloud Paradigm</a>
</li>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="../logistics/index.html" class="">Logistics</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#logistics-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="logistics-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../logistics/schedule.html" class="">Schedule</a>
</li>
          <li class="sidebar-item">
  <a href="../logistics/prerequisites.html" class="">Prerequisites &amp; help</a>
</li>
          <li class="sidebar-item">
  <a href="../logistics/github-workflows.html" class="">GitHub Workflows</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="../tutorials/index.html" class="">Tutorials</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#tutorials-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="tutorials-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../tutorials/00_Setup.html" class="">00. Setup for tutorials</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/01_Data_Discovery_CMR.html" class="">01. Data discovery with CMR</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/02_Data_Discovery_CMR-STAC_API.html" class="">02. Data Discovery with CMR-STAC API</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/03_Xarray.html" class="">03. Introduction to <code>xarray</code></a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/04_NASA_Earthdata_Authentication.html" class="">04. Authentication for NASA Earthdata</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/05_Data_Access_Direct_S3.html" class="">05. Direct S3 Data Access</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/06_S6_OPeNDAP_Access_Gridding.html" class="active">06. Sentinel-6 MF L2 Altimetry Data Access (OPeNDAP) &amp; Gridding</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/07_Data_Access_Harmony_Subsetting.html" class="">Data Subsetting and Transformation Services in the Cloud</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/08_Data_Access_Harmonize-cloud-non-cloud.html" class="">Harmonizing data located within and outside of the NASA Earthdata Cloud</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/09_Zarr_Access.html" class="">09. Zarr Access for NetCDF4 files</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <li class="sidebar-item">
  <a href="../tutorials-templates/index.html" class="">Tutorial Templates</a>
</li>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="../projects/index.html" class="">Projects Overview</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#projectsoverview-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="projectsoverview-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../projects/hackathon-projects.html" class="">Hackathon Projects</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
            <a class="sidebar-section-item d-inline-flex text-start w-100 " data-bs-toggle="collapse" data-bs-target="#additionalresources-collapse" aria-expanded="true">
              <div class="me-auto sidebar-section-item">Additional Resources</div>
            <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
        </div>
      <div class="collapse  show" id="additionalresources-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../tutorials/Additional_Resources__Data_Access__Direct_S3_Access__PODAAC_ECCO_SSH.html" class="">Direct S3 Data Access - Rough PODAAC ECCO SSH Example</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/Additional_Resources__Direct_S3_Access__gdalvrt.html" class="">Direct S3 Data Access with GDAL Virtual Raster Format (VRT)</a>
</li>
          <li class="sidebar-item">
  <a href="../tutorials/Additional_Resources__Direct_S3_Access__rioxarray_clipping.html" class="">Direct S3 Data Access</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
      <ul class="list-unstyled sidebar-section depth1">
    <li class="">
        <div class="me-auto">
          <div class="d-inline-flex w-100 sidebar-section-item">
            <div class="sidebar-section-link me-auto">
            <a href="../clinic/index.html" class="">Pre-Hackathon Clinic</a>
            </div>
            <a class="text-start  " data-bs-toggle="collapse" data-bs-target="#pre-hackathonclinic-collapse" aria-expanded="true">
              <div><i class="bi bi-chevron-right ms-2"></i></div>
            </a>
            </div>
        </div>
      <div class="collapse  show" id="pre-hackathonclinic-collapse">
        <ul class="list-unstyled sidebar-item-contents">
          <li class="sidebar-item">
  <a href="../clinic/jupyterhub.html" class="">NASA Openscapes Cloud Environment</a>
</li>
          <li class="sidebar-item">
  <a href="../clinic/notebooks.html" class="">Notebooks, Python, Git</a>
</li>
          <li class="sidebar-item">
  <a href="../clinic/github.html" class="">GitHub</a>
</li>
          <li class="sidebar-item">
  <a href="../clinic/earthdata.html" class="">Earthdata Login</a>
</li>
        </ul>
      </div>
    </li>
  </ul>
  </ul>
  </div>
</nav>
  </div>
  <div id="quarto-toc-sidebar" class=" pt-0 col col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-toc order-last"><nav id="TOC" role="doc-toc">
<h2 id="toc-title">On this page</h2>
<ul>
<li><a href="#sentinel-6-mf-l2-altimetry-data-access-opendap-gridding" class="nav-link active" data-scroll-target="#sentinel-6-mf-l2-altimetry-data-access-opendap-gridding">06. Sentinel-6 MF L2 Altimetry Data Access (OPeNDAP) &amp; Gridding</a>
<ul class="collapse">
<li><a href="#getting-started" class="nav-link" data-scroll-target="#getting-started">Getting Started</a>
<ul class="collapse">
<li><a href="#summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
<li><a href="#objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a></li>
<li><a href="#requirements" class="nav-link" data-scroll-target="#requirements">Requirements</a></li>
<li><a href="#workspace" class="nav-link" data-scroll-target="#workspace">Workspace</a></li>
</ul></li>
<li><a href="#datasets" class="nav-link" data-scroll-target="#datasets">Dataset(s)</a>
<ul class="collapse">
<li><a href="#render-along-track-altimetry-data-to-the-ecco-grid" class="nav-link" data-scroll-target="#render-along-track-altimetry-data-to-the-ecco-grid">Render along-track altimetry data to the ECCO grid</a></li>
<li><a href="#grid-ssha-or-a-similar-variable" class="nav-link" data-scroll-target="#grid-ssha-or-a-similar-variable">Grid ssha or a similar variable</a></li>
</ul></li>
</ul></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/nasa-openscapes/2021-Cloud-Hackathon/edit/main/tutorials/06_S6_OPeNDAP_Access_Gridding.ipynb" class="toc-action">Edit this page</a></p><p><a href="https://github.com/nasa-openscapes/2021-Cloud-Hackathon/issues/new" class="toc-action">Report an issue</a></p></div></div></nav></div>
  <div class="col mx-auto col-sm-12 col-md-9 col-lg-7 col-xl-7 px-lg-4 pe-xxl-4 ps-xxl-0">
<main>

<section id="sentinel-6-mf-l2-altimetry-data-access-opendap-gridding" class="level1">
<h1>06. Sentinel-6 MF L2 Altimetry Data Access (OPeNDAP) &amp; Gridding</h1>
<p>To-dos: * Add tutorial objectives, e.g.&nbsp;How much data are we selecting/where? Over a certain Cycle? * What is the goal of the tutorial? e.g.&nbsp;Grab ___ cycle(s)/pass(es) to plot satellite altimetry tracks from S6 using opendap in the cloud to only select data we are interested in, reducing the data volume and time-to-data.</p>
<section id="getting-started" class="level2">
<h2 class="anchored" data-anchor-id="getting-started">Getting Started</h2>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p><em>Description goes here…</em></p>
</section>
<section id="objectives" class="level3">
<h3 class="anchored" data-anchor-id="objectives">Objectives</h3>
<p>In this tutorial you will learn…</p>
<ol type="1">
<li>about level 2 radar altimetry data from the Sentinel-6 Michael Freilich mission;</li>
<li>how to efficiently download variable subsets using OPeNDAP;</li>
<li>how to grid the along-track altimetry observations produced by S6 at level 2.;</li>
</ol>
</section>
<section id="requirements" class="level3">
<h3 class="anchored" data-anchor-id="requirements">Requirements</h3>
<p>This workflow was developed using Python 3.9 (and tested against versions 3.7, 3.8).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os.path</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm <span class="im">import</span> tqdm</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> io <span class="im">import</span> StringIO</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> concurrent.futures <span class="im">import</span> ThreadPoolExecutor</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pyresample <span class="im">as</span> pr</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyresample.kd_tree <span class="im">import</span> resample_gauss</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-execution_count="2">
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st"># TEMPORARY, CHECK ENVIRONMENT:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k,v <span class="kw">in</span> <span class="bu">dict</span>(<span class="bu">globals</span>()).items():</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'module'</span> <span class="kw">in</span> <span class="bu">str</span>(<span class="bu">type</span>(v)):</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">hasattr</span>(v, <span class="st">"__path__"</span>):</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>v<span class="sc">.</span><span class="va">__name__</span><span class="sc">}</span><span class="ss">  </span><span class="ch">\t</span><span class="sc">{</span>v<span class="sc">.</span>__version__ <span class="sc">}</span><span class="ch">\t</span><span class="ss">(</span><span class="sc">{</span>v<span class="sc">.</span>__path__[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>
# TEMPORARY, CHECK ENVIRONMENT:

  json      2.0.9   (/srv/conda/envs/notebook/lib/python3.9/json)
  requests      2.26.0  (/srv/conda/envs/notebook/lib/python3.9/site-packages/requests)
  numpy     1.21.4  (/srv/conda/envs/notebook/lib/python3.9/site-packages/numpy)
  pandas    1.3.4   (/srv/conda/envs/notebook/lib/python3.9/site-packages/pandas)
  xarray    0.20.1  (/srv/conda/envs/notebook/lib/python3.9/site-packages/xarray)
  pyresample    1.22.0  (/srv/conda/envs/notebook/lib/python3.9/site-packages/pyresample)</code></pre>
</div>
</div>
</section>
<section id="workspace" class="level3">
<h3 class="anchored" data-anchor-id="workspace">Workspace</h3>
<p>Create some directories inside a temporary user workspace. They will be used to write outputs.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>workspace <span class="op">=</span> <span class="st">"data/"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> d <span class="kw">in</span> [<span class="st">'subsets'</span>, <span class="st">'cycles'</span>]:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    os.makedirs(os.path.join(workspace, d), exist_ok<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>https://docs.python.org/3/library/os.html#os.makedirs</p>
</blockquote>
</section>
</section>
<section id="datasets" class="level2">
<h2 class="anchored" data-anchor-id="datasets">Dataset(s)</h2>
<p>This example operates on Level 2 Low Resolution Altimetry from Sentinel-6 Michael Freilich (the Near Real Time Reduced distribution). It is most easily identified by its collection <em>ShortName</em>, given below:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ShortName <span class="op">=</span> <span class="st">'JASON_CS_S6A_L2_ALT_LR_RED_OST_NRT_F'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Search CMR using a simple function that wraps <code>requests.get</code>:</p>
<section id="collection" class="level4">
<h4 class="anchored" data-anchor-id="collection">collection</h4>
<div class="cell" data-execution_count="5">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url<span class="op">=</span><span class="ss">f"https://cmr.earthdata.nasa.gov/search/collections.umm_json"</span>, </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>                        params<span class="op">=</span><span class="bu">dict</span>(ShortName<span class="op">=</span>ShortName))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'hits:'</span>, response.headers[<span class="st">"cmr-hits"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>hits: 1</code></pre>
</div>
</div>
<p>Get the collection’s <em>concept-id</em> from the record’s <code>meta</code> object. It uniquely identifies the collection in the CMR and is a component of the OPeNDAP endpoints for its granules.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode" id="cb8"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>collection <span class="op">=</span> response.json().get(<span class="st">"items"</span>)[<span class="dv">0</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>concept_id <span class="op">=</span> collection.get(<span class="st">"meta"</span>).get(<span class="st">"concept-id"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(concept_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>C1968980576-POCLOUD</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://docs.python-requests.org/en/latest/api/#requests.get</p>
</blockquote>
</section>
<section id="granules" class="level4">
<h4 class="anchored" data-anchor-id="granules">granules</h4>
<div class="cell" data-execution_count="7">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url<span class="op">=</span><span class="ss">f"https://cmr.earthdata.nasa.gov/search/granules.csv"</span>, </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>                        params<span class="op">=</span><span class="bu">dict</span>(ShortName<span class="op">=</span>ShortName, page_size<span class="op">=</span><span class="dv">2000</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'hits:'</span>, response.headers[<span class="st">"cmr-hits"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>hits: 1783</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://docs.python.org/3/library/io.html#io.StringIO<br>
https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html<br>
https://docs.python-requests.org/en/latest/api/#requests.get</p>
</blockquote>
<div class="cell" data-execution_count="8">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>granules <span class="op">=</span> pd.read_csv(StringIO(response.text))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>granules.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="8">
<div>

<table class="dataframe table">
  <thead>
    <tr>
      <th></th>
      <th>Granule UR</th>
      <th>Producer Granule ID</th>
      <th>Start Time</th>
      <th>End Time</th>
      <th>Online Access URLs</th>
      <th>Browse URLs</th>
      <th>Cloud Cover</th>
      <th>Day/Night</th>
      <th>Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>S6A_P4_2__LR_RED__NR_022_215_20210622T065556_2...</td>
      <td>NaN</td>
      <td>2021-06-22T06:55:56.542Z</td>
      <td>2021-06-22T08:51:49.469Z</td>
      <td>https://archive.podaac.earthdata.nasa.gov/poda...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>UNSPECIFIED</td>
      <td>5.447547</td>
    </tr>
    <tr>
      <th>1</th>
      <td>S6A_P4_2__LR_RED__NR_022_217_20210622T085149_2...</td>
      <td>NaN</td>
      <td>2021-06-22T08:51:49.519Z</td>
      <td>2021-06-22T10:47:27.453Z</td>
      <td>https://archive.podaac.earthdata.nasa.gov/poda...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>UNSPECIFIED</td>
      <td>0.308941</td>
    </tr>
    <tr>
      <th>2</th>
      <td>S6A_P4_2__LR_RED__NR_022_219_20210622T104727_2...</td>
      <td>NaN</td>
      <td>2021-06-22T10:47:27.504Z</td>
      <td>2021-06-22T12:43:06.457Z</td>
      <td>https://archive.podaac.earthdata.nasa.gov/poda...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>UNSPECIFIED</td>
      <td>5.511004</td>
    </tr>
    <tr>
      <th>3</th>
      <td>S6A_P4_2__LR_RED__NR_022_221_20210622T124306_2...</td>
      <td>NaN</td>
      <td>2021-06-22T12:43:06.507Z</td>
      <td>2021-06-22T14:21:12.461Z</td>
      <td>https://archive.podaac.earthdata.nasa.gov/poda...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>UNSPECIFIED</td>
      <td>2.322583</td>
    </tr>
    <tr>
      <th>4</th>
      <td>S6A_P4_2__LR_RED__NR_022_223_20210622T142112_2...</td>
      <td>NaN</td>
      <td>2021-06-22T14:21:12.511Z</td>
      <td>2021-06-22T16:14:50.491Z</td>
      <td>https://archive.podaac.earthdata.nasa.gov/poda...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>UNSPECIFIED</td>
      <td>5.497045</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html</p>
</blockquote>
<p>Display the list of items created by splitting the a value in the <code>Granule UR</code> field.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode" id="cb13"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>granules[<span class="st">'Granule UR'</span>].iloc[<span class="dv">0</span>].split(<span class="st">"_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="9">
<pre><code>['S6A',
 'P4',
 '2',
 '',
 'LR',
 'RED',
 '',
 'NR',
 '022',
 '215',
 '20210622T065556',
 '20210622T085149',
 'F02']</code></pre>
</div>
</div>
<p>References:<br>
https://docs.python.org/3/library/stdtypes.html#str.split<br>
https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.iloc.html</p>
<p><em>Note that cycle and pass are items 8 and 9, respectively, after splitting the <code>Granule UR</code> field by <code>_</code>.</em> Add two columns containing the cycle/pass numbers for granules in the table.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode" id="cb15"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>granules <span class="op">=</span> granules[[<span class="st">'Granule UR'</span>, <span class="st">'Start Time'</span>, <span class="st">'End Time'</span>, <span class="st">'Online Access URLs'</span>]].copy()</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>granules[<span class="st">'cycle'</span>] <span class="op">=</span> granules[<span class="st">'Granule UR'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.split(<span class="st">"_"</span>)[<span class="dv">8</span>])</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>granules[<span class="st">'pass'</span>] <span class="op">=</span> granules[<span class="st">'Granule UR'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.split(<span class="st">"_"</span>)[<span class="dv">9</span>])</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>granules.iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="10">
<pre><code>Granule UR            S6A_P4_2__LR_RED__NR_022_215_20210622T065556_2...
Start Time                                     2021-06-22T06:55:56.542Z
End Time                                       2021-06-22T08:51:49.469Z
Online Access URLs    https://archive.podaac.earthdata.nasa.gov/poda...
cycle                                                               022
pass                                                                215
Name: 0, dtype: object</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.copy.html<br>
https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.apply.html<br>
https://docs.python.org/3/reference/expressions.html#lambda<br>
https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.iloc.html</p>
</blockquote>
<p>Now create a table with one row per cycle and with these columns:</p>
<ol type="1">
<li>start time</li>
<li>end time</li>
<li>granule names (list)</li>
</ol>
<div class="cell" data-execution_count="11">
<div class="sourceCode" id="cb17"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> granules.groupby(<span class="st">"cycle"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>cycles <span class="op">=</span> tmp[<span class="st">'pass'</span>].count().to_frame(<span class="st">"count"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>cycles[<span class="st">'start'</span>] <span class="op">=</span> tmp[<span class="st">'Start Time'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.tolist()) <span class="op">\</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                                   .<span class="bu">apply</span>(<span class="bu">sorted</span>) <span class="op">\</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                                   .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="dv">0</span>])  <span class="co"># index 0</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>cycles[<span class="st">'end'</span>]   <span class="op">=</span> tmp[<span class="st">'End Time'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.tolist()) <span class="op">\</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                                 .<span class="bu">apply</span>(<span class="bu">sorted</span>) <span class="op">\</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>                                 .<span class="bu">apply</span>(<span class="kw">lambda</span> x: x[<span class="op">-</span><span class="dv">1</span>])  <span class="co"># index -1</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>cycles[<span class="st">'grans'</span>] <span class="op">=</span> tmp[<span class="st">'Granule UR'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.tolist())</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>display(cycles)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>

<table class="dataframe table">
  <thead>
    <tr>
      <th></th>
      <th>count</th>
      <th>start</th>
      <th>end</th>
      <th>grans</th>
    </tr>
    <tr>
      <th>cycle</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>022</th>
      <td>20</td>
      <td>2021-06-22T06:55:56.542Z</td>
      <td>2021-06-23T20:29:40.464Z</td>
      <td>[S6A_P4_2__LR_RED__NR_022_215_20210622T065556_...</td>
    </tr>
    <tr>
      <th>023</th>
      <td>126</td>
      <td>2021-06-23T20:29:40.515Z</td>
      <td>2021-07-03T18:28:12.477Z</td>
      <td>[S6A_P4_2__LR_RED__NR_023_001_20210623T202940_...</td>
    </tr>
    <tr>
      <th>024</th>
      <td>122</td>
      <td>2021-07-03T18:28:12.528Z</td>
      <td>2021-07-13T16:26:44.463Z</td>
      <td>[S6A_P4_2__LR_RED__NR_024_001_20210703T182812_...</td>
    </tr>
    <tr>
      <th>025</th>
      <td>125</td>
      <td>2021-07-13T16:26:44.514Z</td>
      <td>2021-07-23T14:25:14.452Z</td>
      <td>[S6A_P4_2__LR_RED__NR_025_001_20210713T162644_...</td>
    </tr>
    <tr>
      <th>026</th>
      <td>126</td>
      <td>2021-07-23T14:25:15.513Z</td>
      <td>2021-08-02T12:23:46.465Z</td>
      <td>[S6A_P4_2__LR_RED__NR_026_001_20210723T142515_...</td>
    </tr>
    <tr>
      <th>027</th>
      <td>126</td>
      <td>2021-08-02T12:23:46.515Z</td>
      <td>2021-08-12T10:22:45.463Z</td>
      <td>[S6A_P4_2__LR_RED__NR_027_001_20210802T122346_...</td>
    </tr>
    <tr>
      <th>028</th>
      <td>125</td>
      <td>2021-08-12T10:22:45.514Z</td>
      <td>2021-08-22T08:21:16.466Z</td>
      <td>[S6A_P4_2__LR_RED__NR_028_001_20210812T102245_...</td>
    </tr>
    <tr>
      <th>029</th>
      <td>125</td>
      <td>2021-08-22T08:21:16.516Z</td>
      <td>2021-09-01T06:19:48.489Z</td>
      <td>[S6A_P4_2__LR_RED__NR_029_001_20210822T082116_...</td>
    </tr>
    <tr>
      <th>030</th>
      <td>118</td>
      <td>2021-09-01T06:19:48.540Z</td>
      <td>2021-09-11T04:18:20.452Z</td>
      <td>[S6A_P4_2__LR_RED__NR_030_001_20210901T061948_...</td>
    </tr>
    <tr>
      <th>031</th>
      <td>111</td>
      <td>2021-09-11T04:18:20.503Z</td>
      <td>2021-09-21T02:16:52.490Z</td>
      <td>[S6A_P4_2__LR_RED__NR_031_001_20210911T041820_...</td>
    </tr>
    <tr>
      <th>032</th>
      <td>126</td>
      <td>2021-09-21T02:16:52.541Z</td>
      <td>2021-10-01T00:15:23.477Z</td>
      <td>[S6A_P4_2__LR_RED__NR_032_001_20210921T021652_...</td>
    </tr>
    <tr>
      <th>033</th>
      <td>127</td>
      <td>2021-10-01T00:15:23.528Z</td>
      <td>2021-10-10T22:13:54.473Z</td>
      <td>[S6A_P4_2__LR_RED__NR_033_001_20211001T001523_...</td>
    </tr>
    <tr>
      <th>034</th>
      <td>127</td>
      <td>2021-10-10T22:13:54.523Z</td>
      <td>2021-10-20T20:12:26.484Z</td>
      <td>[S6A_P4_2__LR_RED__NR_034_001_20211010T221354_...</td>
    </tr>
    <tr>
      <th>035</th>
      <td>127</td>
      <td>2021-10-20T20:12:26.534Z</td>
      <td>2021-10-30T18:10:57.471Z</td>
      <td>[S6A_P4_2__LR_RED__NR_035_001_20211020T201226_...</td>
    </tr>
    <tr>
      <th>036</th>
      <td>127</td>
      <td>2021-10-30T18:10:57.521Z</td>
      <td>2021-11-09T16:09:28.454Z</td>
      <td>[S6A_P4_2__LR_RED__NR_036_001_20211030T181057_...</td>
    </tr>
    <tr>
      <th>037</th>
      <td>25</td>
      <td>2021-11-09T16:09:28.504Z</td>
      <td>2021-11-11T14:58:45.468Z</td>
      <td>[S6A_P4_2__LR_RED__NR_037_001_20211109T160928_...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<blockquote class="blockquote">
<p>https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.to_frame.html<br>
https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html</p>
</blockquote>
</section>
<section id="pick-a-cycle-of-interest" class="level4">
<h4 class="anchored" data-anchor-id="pick-a-cycle-of-interest">Pick a cycle of interest</h4>
<p>Pick one cycle that is nearly complete, &gt;= 120 orbits/files. Limit options to cycles with at least 120 granules/files available (i.e.&nbsp;orbits in S6 context).</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode" id="cb18"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cycles <span class="op">=</span> cycles[cycles[<span class="st">'count'</span>]<span class="op">&gt;=</span><span class="dv">120</span>].copy()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>cycles.index.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="12">
<pre><code>['023',
 '024',
 '025',
 '026',
 '027',
 '028',
 '029',
 '032',
 '033',
 '034',
 '035',
 '036']</code></pre>
</div>
</div>
<p>Choose from the nearly-complete cycles that remain in the table, which start with cycle number <code>023</code> for S6 data in the public domain (and start on June 22). Slice the table of <em>granules</em> to exclude all rows that are not from the cycle of interest.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode" id="cb20"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>my_cycle <span class="op">=</span> <span class="dv">25</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>granules <span class="op">=</span> granules[granules.cycle.astype(<span class="bu">int</span>)<span class="op">==</span>my_cycle].copy()</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>granules.index.size</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="13">
<pre><code>125</code></pre>
</div>
</div>
</section>
<section id="opendap-access-endpoints" class="level4">
<h4 class="anchored" data-anchor-id="opendap-access-endpoints">OPeNDAP Access Endpoints</h4>
<p>All endpoints for granules/files in OPeNDAP/Hyrax start with the server hostname and path to the parent collection, followed by <em>granules</em>. The collection is specified by the <em>concept-id</em> given right after <em>collections</em> in a valid url. The next cell formats a string giving the base url to which we will append granule filenames (stored in the <code>Granule UR</code> column of the <em>granules</em> table) to get the full url/endpoint for each granule.</p>
<p><em>Fyi, the url printed by this cell will not be accessible from your web browser.</em></p>
<div class="cell" data-execution_count="14">
<div class="sourceCode" id="cb22"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>collection_opendap_endpoint <span class="op">=</span> <span class="ss">f"https://opendap.earthdata.nasa.gov/collections/</span><span class="sc">{</span>concept_id<span class="sc">}</span><span class="ss">/granules"</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(collection_opendap_endpoint)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>https://opendap.earthdata.nasa.gov/collections/C1968980576-POCLOUD/granules</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://docs.python.org/3/library/string.html#format-string-syntax</p>
</blockquote>
<p>Appending the granule name (taken from the <code>Granule UR</code> column) to the end of the url above results in a valid endpoint. You can click the one printed by this cell to confirm. A new browser tab should open to the HTML access form served by Hyrax/OPeNDAP.</p>
<p>Make a new column with the <code>nc4</code> download url for all granules.</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode" id="cb24"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>granules[<span class="st">'nc4'</span>] <span class="op">=</span> granules[<span class="st">'Granule UR'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>collection_opendap_endpoint<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">.nc4"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>granules.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 125 entries, 268 to 392
Data columns (total 7 columns):
 #   Column              Non-Null Count  Dtype 
---  ------              --------------  ----- 
 0   Granule UR          125 non-null    object
 1   Start Time          125 non-null    object
 2   End Time            125 non-null    object
 3   Online Access URLs  125 non-null    object
 4   cycle               125 non-null    object
 5   pass                125 non-null    object
 6   nc4                 125 non-null    object
dtypes: object(7)
memory usage: 7.8+ KB</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.info.html</p>
</blockquote>
<section id="pick-target-datacoordinate-variables" class="level5">
<h5 class="anchored" data-anchor-id="pick-target-datacoordinate-variables">Pick target data/coordinate variables</h5>
<p>Display the url to access the DDS file for the first granule:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode" id="cb26"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dds <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>collection_opendap_endpoint<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>granules[<span class="st">'Granule UR'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">.dds"</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> requests.get(url<span class="op">=</span>dds) <span class="im">as</span> r:</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(r.text)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Dataset {
    Int16 data_01_rad_tb_238[data_01_time = 6950];
    Int16 data_01_rad_wet_tropo_cor[data_01_time = 6950];
    Int16 data_01_wind_speed_mod_v[data_01_time = 6950];
    Int32 data_01_rad_distance_to_land[data_01_time = 6950];
    Int16 data_01_rad_tmb_340_qual[data_01_time = 6950];
    Int16 data_01_iono_cor_alt_filtered_mle3[data_01_time = 6950];
    Int16 data_01_rad_tmb_187_qual[data_01_time = 6950];
    Int16 data_01_rad_water_vapor[data_01_time = 6950];
    Int16 data_01_mean_sea_surface_sol1_qual[data_01_time = 6950];
    Int16 data_01_climato_use_flag[data_01_time = 6950];
    Int16 data_01_wind_speed_mod_u[data_01_time = 6950];
    Int16 data_01_distance_to_coast[data_01_time = 6950];
    Int16 data_01_pass_direction_flag[data_01_time = 6950];
    Int32 data_01_altitude_rate_mean_sea_surface[data_01_time = 6950];
    Int16 data_01_mean_sea_surface_sol2_acc[data_01_time = 6950];
    Int16 data_01_model_dry_tropo_cor_measurement_altitude[data_01_time = 6950];
    Int16 data_01_rad_tmb_187[data_01_time = 6950];
    Int16 data_01_pole_tide[data_01_time = 6950];
    Int16 data_01_rad_tmb_238[data_01_time = 6950];
    Int16 data_01_mean_dynamic_topography_acc[data_01_time = 6950];
    Int16 data_01_rad_land_frac_238[data_01_time = 6950];
    Int16 data_01_load_tide_sol2[data_01_time = 6950];
    Int16 data_01_ocean_tide_non_eq[data_01_time = 6950];
    Int16 data_01_ocean_tide_sol1_qual[data_01_time = 6950];
    Int16 data_01_iono_cor_alt_filtered[data_01_time = 6950];
    Int16 data_01_rad_water_vapor_qual[data_01_time = 6950];
    Int16 data_01_depth_or_elevation[data_01_time = 6950];
    Int16 data_01_rad_tb_340[data_01_time = 6950];
    Int32 data_01_off_nadir_roll_angle_pf[data_01_time = 6950];
    Int16 data_01_rad_tb_187_qual[data_01_time = 6950];
    Int16 data_01_rad_tb_238_qual[data_01_time = 6950];
    Int32 data_01_longitude[data_01_time = 6950];
    Int16 data_01_manoeuvre_flag[data_01_time = 6950];
    Int32 data_01_latitude[data_01_time = 6950];
    Int16 data_01_model_dry_tropo_cor_zero_altitude[data_01_time = 6950];
    Int16 data_01_orbit_type_flag[data_01_time = 6950];
    Int32 data_01_mean_sea_surface_sol1[data_01_time = 6950];
    Int16 data_01_solid_earth_tide[data_01_time = 6950];
    Int16 data_01_c_net_instr_cor_sig0_ocean[data_01_time = 6950];
    Int32 data_01_c_net_instr_cor_range_ocean[data_01_time = 6950];
    Int16 data_01_c_rad_atm_cor_sig0_qual[data_01_time = 6950];
    Int16 data_01_c_sig0_ocean_numval[data_01_time = 6950];
    Int32 data_01_c_range_ocean[data_01_time = 6950];
    Int16 data_01_c_swh_ocean_rms[data_01_time = 6950];
    Int16 data_01_c_sig0_ocean[data_01_time = 6950];
    Int16 data_01_c_net_instr_cor_swh_ocean[data_01_time = 6950];
    Int16 data_01_c_sig0_ocean_rms[data_01_time = 6950];
    Int16 data_01_c_sea_state_bias[data_01_time = 6950];
    Int16 data_01_c_range_ocean_rms[data_01_time = 6950];
    Int16 data_01_c_swh_ocean_numval[data_01_time = 6950];
    Int16 data_01_c_swh_ocean[data_01_time = 6950];
    Int16 data_01_c_iono_cor_gim[data_01_time = 6950];
    Int16 data_01_c_swh_ocean_qual[data_01_time = 6950];
    Int32 data_01_c_index_first_20hz_measurement[data_01_time = 6950];
    Int32 data_01_c_model_instr_cor_range_ocean[data_01_time = 6950];
    Int16 data_01_c_range_ocean_qual[data_01_time = 6950];
    Int16 data_01_c_sig0_ocean_qual[data_01_time = 6950];
    Int16 data_01_c_model_instr_cor_swh_ocean[data_01_time = 6950];
    Int16 data_01_c_atm_cor_sig0[data_01_time = 6950];
    Int16 data_01_c_model_instr_cor_sig0_ocean[data_01_time = 6950];
    Int16 data_01_c_range_ocean_numval[data_01_time = 6950];
    Int32 data_01_c_range_cor_doppler[data_01_time = 6950];
    Int16 data_01_c_numtotal_20hz_measurement[data_01_time = 6950];
    Int16 data_01_dac[data_01_time = 6950];
    Int16 data_01_surface_classification_flag[data_01_time = 6950];
    Float64 data_01_time_tai[data_01_time = 6950];
    Int32 data_01_altitude[data_01_time = 6950];
    Int32 data_01_off_nadir_pitch_angle_pf[data_01_time = 6950];
    Int16 data_01_rain_attenuation[data_01_time = 6950];
    Int16 data_01_ocean_tide_eq[data_01_time = 6950];
    Int16 data_01_mean_dynamic_topography_qual[data_01_time = 6950];
    Int32 data_01_delta_ellipsoid_tp_wgs84[data_01_time = 6950];
    Int16 data_01_rad_tmb_340[data_01_time = 6950];
    Int16 data_01_rad_rain_flag[data_01_time = 6950];
    Int16 data_01_rad_tb_340_qual[data_01_time = 6950];
    Int16 data_01_mean_sea_surface_sol2_qual[data_01_time = 6950];
    Int16 data_01_rad_surface_type_flag[data_01_time = 6950];
    Int16 data_01_rad_land_frac_340[data_01_time = 6950];
    Int16 data_01_ku_sig0_ocean_mle3_qual[data_01_time = 6950];
    Int16 data_01_ku_net_instr_cor_sig0_ocean[data_01_time = 6950];
    Int32 data_01_ku_net_instr_cor_range_ocean[data_01_time = 6950];
    Int16 data_01_ku_range_ocean_mle3_rms[data_01_time = 6950];
    Int16 data_01_ku_rad_atm_cor_sig0_qual[data_01_time = 6950];
    Int16 data_01_ku_sea_state_bias_mle3[data_01_time = 6950];
    Int16 data_01_ku_off_nadir_angle_wf_ocean_rms[data_01_time = 6950];
    Int32 data_01_ku_net_instr_cor_range_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_net_instr_cor_swh_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_sig0_ocean_numval[data_01_time = 6950];
    Int16 data_01_ku_swh_ocean_mle3_qual[data_01_time = 6950];
    Int32 data_01_ku_range_ocean[data_01_time = 6950];
    Int32 data_01_ku_ssha_mle3[data_01_time = 6950];
    Int16 data_01_ku_model_instr_cor_sig0_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_swh_ocean_rms[data_01_time = 6950];
    Int16 data_01_ku_net_instr_cor_sig0_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_sig0_ocean[data_01_time = 6950];
    Int16 data_01_ku_sig0_ocean_mle3_numval[data_01_time = 6950];
    Int16 data_01_ku_net_instr_cor_swh_ocean[data_01_time = 6950];
    Int16 data_01_ku_swh_ocean_mle3_numval[data_01_time = 6950];
    Int16 data_01_ku_sig0_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_off_nadir_angle_wf_ocean_numval[data_01_time = 6950];
    Int16 data_01_ku_model_instr_cor_off_nadir_angle_wf_ocean[data_01_time = 6950];
    Int16 data_01_ku_sig0_ocean_rms[data_01_time = 6950];
    Int16 data_01_ku_sea_state_bias[data_01_time = 6950];
    Int32 data_01_ku_ocean_geo_corrections_mle3[data_01_time = 6950];
    Int16 data_01_ku_range_ocean_rms[data_01_time = 6950];
    Int16 data_01_ku_swh_ocean_numval[data_01_time = 6950];
    Int16 data_01_ku_off_nadir_angle_wf_ocean[data_01_time = 6950];
    Int16 data_01_ku_swh_ocean[data_01_time = 6950];
    Int16 data_01_ku_iono_cor_gim[data_01_time = 6950];
    Int32 data_01_ku_ocean_geo_corrections[data_01_time = 6950];
    Int16 data_01_ku_range_ocean_mle3_qual[data_01_time = 6950];
    Int16 data_01_ku_swh_ocean_qual[data_01_time = 6950];
    Int32 data_01_ku_index_first_20hz_measurement[data_01_time = 6950];
    Int32 data_01_ku_model_instr_cor_range_ocean[data_01_time = 6950];
    Int16 data_01_ku_range_ocean_qual[data_01_time = 6950];
    Int32 data_01_ku_model_instr_cor_range_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_sig0_ocean_qual[data_01_time = 6950];
    Int32 data_01_ku_range_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_range_ocean_mle3_numval[data_01_time = 6950];
    Int16 data_01_ku_net_instr_cor_off_nadir_angle_wf_ocean[data_01_time = 6950];
    Int16 data_01_ku_off_nadir_angle_wf_ocean_qual[data_01_time = 6950];
    Int32 data_01_ku_ssha[data_01_time = 6950];
    Int16 data_01_ku_model_instr_cor_swh_ocean[data_01_time = 6950];
    Int16 data_01_ku_model_instr_cor_swh_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_swh_ocean_mle3_rms[data_01_time = 6950];
    Int16 data_01_ku_atm_cor_sig0[data_01_time = 6950];
    Int16 data_01_ku_model_instr_cor_sig0_ocean[data_01_time = 6950];
    Int16 data_01_ku_swh_ocean_mle3[data_01_time = 6950];
    Int16 data_01_ku_range_ocean_numval[data_01_time = 6950];
    Int32 data_01_ku_range_cor_doppler[data_01_time = 6950];
    Int16 data_01_ku_sig0_ocean_mle3_rms[data_01_time = 6950];
    Int16 data_01_ku_numtotal_20hz_measurement[data_01_time = 6950];
    Int16 data_01_iono_cor_alt_mle3[data_01_time = 6950];
    Int16 data_01_load_tide_sol1[data_01_time = 6950];
    Int16 data_01_rad_wet_tropo_cor_qual[data_01_time = 6950];
    Int16 data_01_rad_land_frac_187[data_01_time = 6950];
    Int16 data_01_rad_tb_187[data_01_time = 6950];
    Int16 data_01_inv_bar_cor[data_01_time = 6950];
    Int32 data_01_geoid[data_01_time = 6950];
    Int16 data_01_internal_tide[data_01_time = 6950];
    Int16 data_01_mean_dynamic_topography[data_01_time = 6950];
    Int32 data_01_altitude_rate[data_01_time = 6950];
    Int16 data_01_rad_sea_ice_flag[data_01_time = 6950];
    Int16 data_01_rad_wind_speed[data_01_time = 6950];
    Int16 data_01_total_electron_content[data_01_time = 6950];
    Int16 data_01_ocean_tide_sol2[data_01_time = 6950];
    Int16 data_01_angle_of_approach_to_coast[data_01_time = 6950];
    Int16 data_01_meteo_map_availability_flag[data_01_time = 6950];
    Int32 data_01_l2_record_counter[data_01_time = 6950];
    Int16 data_01_wind_speed_alt[data_01_time = 6950];
    Int16 data_01_rad_state_oper_flag[data_01_time = 6950];
    Int16 data_01_wind_speed_alt_mle3[data_01_time = 6950];
    Int16 data_01_rain_flag[data_01_time = 6950];
    Int32 data_01_mean_sea_surface_sol2[data_01_time = 6950];
    Int16 data_01_rad_wind_speed_qual[data_01_time = 6950];
    Int16 data_01_rad_cloud_liquid_water_qual[data_01_time = 6950];
    Int16 data_01_iono_cor_alt[data_01_time = 6950];
    Int16 data_01_rad_tmb_238_qual[data_01_time = 6950];
    Int16 data_01_ocean_tide_sol1[data_01_time = 6950];
    Int16 data_01_ocean_tide_sol2_qual[data_01_time = 6950];
    Int16 data_01_rad_cloud_liquid_water[data_01_time = 6950];
    Int16 data_01_model_wet_tropo_cor_zero_altitude[data_01_time = 6950];
    Int16 data_01_mean_sea_surface_sol1_acc[data_01_time = 6950];
    Int32 data_01_off_nadir_yaw_angle_pf[data_01_time = 6950];
    Int16 data_01_model_wet_tropo_cor_measurement_altitude[data_01_time = 6950];
    Float64 data_01_time[data_01_time = 6950];
} S6A_P4_2__LR_RED__NR_025_001_20210713T162644_20210713T182234_F02.nc;
</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.iloc.html</p>
</blockquote>
<p>Assemble the list of target variables that you will subset from each granule/file using OPeNDAP.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [<span class="st">'data_01_time'</span>,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>             <span class="st">'data_01_longitude'</span>,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">'data_01_latitude'</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>             <span class="st">'data_01_ku_ssha'</span>, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>https://docs.python.org/3/library/stdtypes.html#list</p>
</blockquote>
<p>Join the list of variables with commas and append the resulting string to the end of each opendap <code>nc4</code> endpoint created during the steps above. The variables given after the <code>?</code> will be subset from the source file on the server-side into a new netCDF4 file that OPeNDAP returns in response content which is downloaded over https.</p>
<p>Here’s an example for the first granule in the selected cycle. Clicking this link should download a netCDF4 containing the target variables (4 of them, in my case). *You may be prompted to authenticate with your Earthdata Login account info.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode" id="cb29"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>granules[<span class="st">'subset'</span>] <span class="op">=</span> granules[<span class="st">'nc4'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> url: <span class="ss">f"</span><span class="sc">{</span>url<span class="sc">}</span><span class="ss">?</span><span class="sc">{</span><span class="st">','</span><span class="sc">.</span>join(variables)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(granules[<span class="st">'subset'</span>].iloc[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>https://opendap.earthdata.nasa.gov/collections/C1968980576-POCLOUD/granules/S6A_P4_2__LR_RED__NR_025_001_20210713T162644_20210713T182234_F02.nc4?data_01_time,data_01_longitude,data_01_latitude,data_01_ku_ssha</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://opendap.github.io/documentation/UserGuideComprehensive.html#Constraint_Expressions (Hyrax/OPeNDAP docs)</p>
</blockquote>
</section>
</section>
<section id="download-subsets" class="level4">
<h4 class="anchored" data-anchor-id="download-subsets">Download subsets</h4>
<p>This function downloads one granule from the remote <code>url</code> to a local <code>target</code> path, and will reliably manage simultaneous streaming downloads divided between multiple threads.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> download(url: <span class="bu">str</span>, target: <span class="bu">str</span>, force: <span class="bu">bool</span><span class="op">=</span><span class="va">False</span>):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> os.path.isfile(target) <span class="kw">or</span> force <span class="kw">is</span> <span class="va">True</span>:</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> requests.get(url) <span class="im">as</span> response, <span class="bu">open</span>(target, <span class="st">'wb'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="kw">not</span> response.status_code <span class="op">//</span> <span class="dv">100</span> <span class="op">==</span> <span class="dv">2</span>: </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">Exception</span>(response.text)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> chunk <span class="kw">in</span> response.iter_content(chunk_size<span class="op">=</span><span class="dv">1024</span>):</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> chunk:</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">file</span>.write(chunk)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> target</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>https://docs.python.org/3/library/os.path.html#os.path.isfile<br>
https://docs.python-requests.org/en/latest/api/#requests.Response.text<br>
https://docs.python-requests.org/en/latest/api/#requests.Response.status_code<br>
https://docs.python-requests.org/en/latest/api/#requests.Response.iter_content</p>
</blockquote>
<div class="sourceCode" id="cb32"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!ls data/subsets/*NR_025*.nc4 | wc -l</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co">#!rm data/subsets/*NR_025*.nc4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><em>This next cell assembles a list of local paths for the subset downloads.</em></p>
<p>Calling <code>tolist</code> on the resulting Series will convert it to a Python list (by way of the <em>numpy</em> method, <em>tolist</em>). Use <em>zip</em> merge the lists of <em>subset</em> urls and local paths, itemwise. The result will be a list of lists, each length two and containing a remote url and local path (corresponding to two positional arguments in the <em>download</em> function that will be defined in a subsequent cell).</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode" id="cb33"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>download_targets <span class="op">=</span> granules[<span class="st">'Granule UR'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="ss">f"data/subsets/</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">.nc4"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>download_arguments <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(granules[<span class="st">'subset'</span>].tolist(), download_targets.tolist()))</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(download_arguments), <span class="bu">len</span>(download_arguments)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="21">
<pre><code>(list, 125)</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.tolist.html</p>
</blockquote>
<p><em>This next cell creates a pool of workers to divide the list of downloads between multiple threads.</em></p>
<p>Use the <code>ThreadPoolExecutor</code> from <code>concurrent.futures</code> module (in the Python 3 standard library) to divide the 120+ download jobs between multiple threads and run them concurrently. This should take no more than a minute or two to process all subsets on the server side and download to the local host.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode" id="cb35"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> ThreadPoolExecutor(max_workers<span class="op">=</span><span class="dv">12</span>) <span class="im">as</span> pool:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    workers <span class="op">=</span> pool.<span class="bu">map</span>(<span class="kw">lambda</span> x: download(<span class="op">*</span>x), download_arguments)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    granules[<span class="st">'local'</span>] <span class="op">=</span> <span class="bu">list</span>(tqdm(workers, total<span class="op">=</span><span class="bu">len</span>(download_arguments)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stderr">
<pre><code>100%|██████████| 125/125 [00:00&lt;00:00, 4377.71it/s]</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://docs.python.org/3/library/concurrent.futures.html#threadpoolexecutor</p>
</blockquote>
<p>The source files range from 2.5MB to 3.0MB. These OPeNDAP subsets are ~100KB apiece. (anecdote: it took less than 10 minutes to download subsets for &gt;1700 granules/files when I ran this routine for all cycles going back to 2021-06-22.) Here we call the shell <em>du</em> and <em>ls</em> utilities to get the size of the directory:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode" id="cb37"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>bash</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>du <span class="op">-</span>sh data<span class="op">/</span>subsets<span class="op">/</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>ls data<span class="op">/</span>subsets<span class="op">/*</span>.nc4 <span class="op">|</span> wc <span class="op">-</span>l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>184M    data/subsets/
1758</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://www.gnu.org/software/coreutils/manual/html_node/du-invocation.html</p>
</blockquote>
<p>Confirm that a netcdf file exists on disk for all the file paths in the <em>local</em> column.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode" id="cb39"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>granules[<span class="st">'local'</span>].<span class="bu">apply</span>(os.path.isfile).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="24">
<pre><code>True</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://docs.python.org/3/library/functions.html#sorted<br>
https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.all.html</p>
</blockquote>
</section>
<section id="aggregate-to-cycle" class="level4">
<h4 class="anchored" data-anchor-id="aggregate-to-cycle">Aggregate to cycle</h4>
<p>Make a dictionary to rename variables so that the <code>data_01_</code> prefix is removed from each one.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode" id="cb41"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>new_variable_names <span class="op">=</span> <span class="bu">list</span>(<span class="bu">map</span>(<span class="kw">lambda</span> x: x.split(<span class="st">"_"</span>)[<span class="op">-</span><span class="dv">1</span>], variables))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>map_variable_names <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(variables, new_variable_names))</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>map_variable_names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="25">
<pre><code>{'data_01_time': 'time',
 'data_01_longitude': 'longitude',
 'data_01_latitude': 'latitude',
 'data_01_ku_ssha': 'ssha'}</code></pre>
</div>
</div>
<p>References:<br>
https://docs.python.org/3/library/functions.html#map<br>
https://docs.python.org/3/library/functions.html#zip</p>
<p>Sort the list of local paths to the downloaded subsets to ensure they concatenate in proper order. Call <code>open_mfdataset</code> on the list to open all the subsets in memory as one dataset in xarray.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode" id="cb43"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>local <span class="op">=</span> <span class="bu">sorted</span>(granules[<span class="st">'local'</span>].tolist())</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>dataset <span class="op">=</span> xr.open_mfdataset(local).rename(map_variable_names)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>&lt;xarray.Dataset&gt;
Dimensions:    (time: 827001)
Coordinates:
  * time       (time) datetime64[ns] 2021-07-13T16:26:45 ... 2021-07-23T14:25:14
Data variables:
    longitude  (time) float64 dask.array&lt;chunksize=(6950,), meta=np.ndarray&gt;
    latitude   (time) float64 dask.array&lt;chunksize=(6950,), meta=np.ndarray&gt;
    ssha       (time) float64 dask.array&lt;chunksize=(6950,), meta=np.ndarray&gt;
Attributes: (12/63)
    Convention:                             CF-1.7
    institution:                            EUMETSAT
    references:                             Sentinel-6_Jason-CS ALT Generic P...
    contact:                                ops@eumetsat.int
    radiometer_sensor_name:                 AMR-C
    doris_sensor_name:                      DORIS
    ...                                     ...
    xref_solid_earth_tide:                  S6__P4_2__SETD_AX_20151008T000000...
    xref_surface_classification:            S6__P4____SURF_AX_20151008T000000...
    xref_wind_speed_alt:                    S6A_P4_2__WNDL_AX_20151008T000000...
    product_name:                           S6A_P4_2__LR______20210713T162644...
    history:                                2021-07-13 18:38:07 : Creation\n2...
    history_json:                           [{"$schema":"https:\/\/harmony.ea...</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://tqdm.github.io/docs/tqdm/#pandas<br>
https://xarray.pydata.org/en/stable/generated/xarray.open_mfdataset.html<br>
https://xarray.pydata.org/en/stable/generated/xarray.Dataset.rename.html</p>
</blockquote>
</section>
<section id="render-along-track-altimetry-data-to-the-ecco-grid" class="level3">
<h3 class="anchored" data-anchor-id="render-along-track-altimetry-data-to-the-ecco-grid">Render along-track altimetry data to the ECCO grid</h3>
<blockquote class="blockquote">
<p><strong>Acknowledgement</strong> <em>This approach using <code>pyresample</code> was shared to me by Ian Fenty, ECCO Lead.</em></p>
</blockquote>
<p>ECCO V4r4 products are distributed in two spatial formats. One set of collections provides the ocean state estimates on the native model grid (LLC0090) and the other provides them after interpolating to a regular grid defined in geographic coordinates with horizontal cell size of 0.5-degrees.</p>
<section id="download-the-ecco-v4r4-0.5-deg-grid-geometry-and-mask" class="level4">
<h4 class="anchored" data-anchor-id="download-the-ecco-v4r4-0.5-deg-grid-geometry-and-mask">Download the ECCO V4r4 0.5-Deg Grid Geometry and Mask</h4>
<p>It’s distributed as its own dataset/collection containing just one file. We can access it over OPeNDAP like demonstrated above or simply download it from the HTTPS download endpoint – the file size is inconsequential. The next cell downloads the file into the <em>data</em> folder from the granule’s https endpoint.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode" id="cb45"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ecco_url <span class="op">=</span> <span class="st">"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/ECCO_L4_GEOMETRY_05DEG_V4R4/GRID_GEOMETRY_ECCO_V4r4_latlon_0p50deg.nc"</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>ecco_file <span class="op">=</span> download(ecco_url, target<span class="op">=</span><span class="ss">f"data/</span><span class="sc">{</span>os<span class="sc">.</span>path<span class="sc">.</span>basename(ecco_url)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>ecco_grid <span class="op">=</span> xr.open_dataset(ecco_file)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ecco_grid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>&lt;xarray.Dataset&gt;
Dimensions:         (Z: 50, latitude: 360, longitude: 720, nv: 2)
Coordinates:
  * Z               (Z) float32 -5.0 -15.0 -25.0 ... -5.461e+03 -5.906e+03
  * latitude        (latitude) float32 -89.75 -89.25 -88.75 ... 89.25 89.75
  * longitude       (longitude) float32 -179.8 -179.2 -178.8 ... 179.2 179.8
    latitude_bnds   (latitude, nv) float32 ...
    longitude_bnds  (longitude, nv) float32 ...
    Z_bnds          (Z, nv) float32 ...
Dimensions without coordinates: nv
Data variables:
    hFacC           (Z, latitude, longitude) float64 ...
    Depth           (latitude, longitude) float64 ...
    area            (latitude, longitude) float64 ...
    drF             (Z) float32 ...
    maskC           (Z, latitude, longitude) bool ...
Attributes: (12/57)
    acknowledgement:                 This research was carried out by the Jet...
    author:                          Ian Fenty and Ou Wang
    cdm_data_type:                   Grid
    comment:                         Fields provided on a regular lat-lon gri...
    Conventions:                     CF-1.8, ACDD-1.3
    coordinates_comment:             Note: the global 'coordinates' attribute...
    ...                              ...
    references:                      ECCO Consortium, Fukumori, I., Wang, O.,...
    source:                          The ECCO V4r4 state estimate was produce...
    standard_name_vocabulary:        NetCDF Climate and Forecast (CF) Metadat...
    summary:                         This dataset provides geometric paramete...
    title:                           ECCO Geometry Parameters for the 0.5 deg...
    uuid:                            b4795c62-86e5-11eb-9c5f-f8f21e2ee3e0</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>https://docs.python.org/3/library/os.path.html#os.path.basename<br>
https://xarray.pydata.org/en/stable/generated/xarray.open_dataset.html</p>
</blockquote>
<p>The <code>maskC</code> variable contains a boolean mask representing the wet/dry state of the area contained in each cell of the 3d grid defined by <code>Z</code> and <code>latitude</code> and <code>longitude</code>.</p>
<p>Here are the variable’s attributes:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode" id="cb47"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>ecco_grid.maskC.attrs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="28">
<pre><code>{'coverage_content_type': 'modelResult',
 'long_name': 'wet/dry boolean mask for grid cell',
 'comment': 'True for grid cells with nonzero open vertical fraction (hFacC &gt; 0), otherwise False.'}</code></pre>
</div>
</div>
<p>So, the mask derives from another variable <code>hFacC</code> that essentially describes 3d space/volume contained within each model grid cell by the fractional area representing the horizontal coverage (in the <code>longitude,latitude</code> dimensions) within each vertical/depth layer.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode" id="cb49"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>ecco_grid.hFacC.attrs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="29">
<pre><code>{'coverage_content_type': 'modelResult',
 'long_name': 'vertical open fraction of grid cell',
 'units': '1',
 'comment': 'Grid cells may be fractionally closed in the vertical. The open vertical fraction is hFacC. The model allows for partially-filled cells to represent topographic variations more smoothly (hFacC &lt; 1). Completely closed (dry) tracer grid cells have hFacC = 0. Note: the lat-lon gridded hFacC is spatially-averaged from the hFacC field on the lat-lon-cap (llc90) model native grid. The total ocean volume of the ECCO V4r4 lat-lon gridded fields is within 0.05% of the total ocean volume of the native grid fields.'}</code></pre>
</div>
</div>
<p>Select the 2d array from <code>maskC</code> that corresponds to the depth layer at ocean surface (i.e.&nbsp;at index <code>0</code> on the <code>Z</code> axis/dimension) and then produce a boolean array where True represents cells with a value greater than <code>0</code>. The resulting array/grid is our land/water mask for the 2d grids generated during the next few steps.</p>
<p>Plot the land/water mask:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode" id="cb51"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ecco_mask <span class="op">=</span> ecco_grid.maskC.isel(Z<span class="op">=</span><span class="dv">0</span>)<span class="op">&gt;</span><span class="dv">0</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>ecco_mask.plot(figsize<span class="op">=</span>(<span class="dv">13</span>, <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="30">
<pre><code>&lt;matplotlib.collections.QuadMesh at 0x7f3157ef2970&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="06_S6_OPeNDAP_Access_Gridding_files/figure-html/cell-31-output-2.png" class="img-fluid"></p>
</div>
</div>
<blockquote class="blockquote">
<p>https://xarray.pydata.org/en/stable/generated/xarray.DataArray.isel.html<br>
https://xarray.pydata.org/en/stable/generated/xarray.DataArray.plot.html</p>
</blockquote>
</section>
</section>
<section id="grid-ssha-or-a-similar-variable" class="level3">
<h3 class="anchored" data-anchor-id="grid-ssha-or-a-similar-variable">Grid ssha or a similar variable</h3>
<p><em>Jinbo’s recommendation: wrap this logic for parameterization by workshop attendees.</em></p>
<p>Get a single timestamp to represent the midpoint of the cycle.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode" id="cb53"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> np.datetime64(dataset[<span class="st">'time'</span>].mean().data)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>2021-07-18T15:11:35.073955170</code></pre>
</div>
</div>
<p>Access the target variable, <em>ssha</em> in this case, and make a nan mask.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode" id="cb55"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ssha <span class="op">=</span> dataset.ssha</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>nans <span class="op">=</span> <span class="op">~</span>np.isnan(ssha.values)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ssha)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>&lt;xarray.DataArray 'ssha' (time: 827001)&gt;
dask.array&lt;concatenate, shape=(827001,), dtype=float64, chunksize=(6981,), chunktype=numpy.ndarray&gt;
Coordinates:
  * time     (time) datetime64[ns] 2021-07-13T16:26:45 ... 2021-07-23T14:25:14
Attributes:
    long_name:      sea surface height anomaly
    standard_name:  sea_surface_height_above_sea_level
    units:          m
    comment:        Sea surface height anomaly = altitude of satellite (altit...
    coordinates:    /data_01/longitude /data_01/latitude
    origname:       ssha
    fullnamepath:   /data_01/ku/ssha</code></pre>
</div>
</div>
<p>Define a simple function <em>get_grid_defn</em> to validate input arrays of longitudes/latitudes and return a <em>pyresample.geometry.SwathDefinition</em> object. (We use it twice to define source/target grids in the next steps.)</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_grid_defn(lons: np.ndarray, lats: np.ndarray):</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> lats.<span class="bu">min</span>() <span class="op">&lt;</span>  <span class="op">-</span><span class="fl">90.</span> <span class="kw">or</span> lats.<span class="bu">max</span>() <span class="op">&gt;</span> <span class="fl">90.</span>:  <span class="co">#1</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">'Found invalid latitudes, aborting - see if condition 1</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> lons.<span class="bu">min</span>() <span class="op">&lt;</span> <span class="op">-</span><span class="fl">180.</span> <span class="kw">or</span> lons.<span class="bu">max</span>() <span class="op">&gt;=</span> <span class="fl">180.</span>:  <span class="co">#2</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">'Found invalid longitudes, wrapping - see if condition 2</span><span class="ch">\n</span><span class="st">'</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>        lons <span class="op">=</span> (lons <span class="op">+</span> <span class="dv">180</span>) <span class="op">%</span> <span class="dv">360</span> <span class="op">-</span> <span class="dv">180</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pr.SwathDefinition(lons, lats)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Define source grid/geometry for the input along-track data. (They are stored as 1-dimensional arrays.)</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode" id="cb58"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>lons <span class="op">=</span> dataset.longitude.values</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>lats <span class="op">=</span> dataset.latitude.values</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>alt_grid_defn <span class="op">=</span> get_grid_defn(lons[nans], lats[nans])</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(alt_grid_defn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>Found invalid longitudes, wrapping - see if condition 2
</code></pre>
</div>
<div class="cell-output-display" data-execution_count="34">
<pre><code>pyresample.geometry.SwathDefinition</code></pre>
</div>
</div>
<p>Define target grid based on the longitudes and latitudes from the ECCO grid geometry dataset. This time define the grid using two 2-dimensional arrays that give positions of all SSHA values in geographic/longitude-latitude coordinates.</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode" id="cb61"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>ecco_lons <span class="op">=</span> ecco_grid.longitude.values</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>ecco_lats <span class="op">=</span> ecco_grid.latitude.values</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>ecco_lons_2d, ecco_lats_2d <span class="op">=</span> np.meshgrid(ecco_lons, ecco_lats)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(ecco_lons_2d.shape, ecco_lats_2d.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>(360, 720) (360, 720)</code></pre>
</div>
</div>
<p>Make the <em>pyresample</em> object for the target grid and proceed.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>ecco_grid_defn <span class="op">=</span> get_grid_defn(ecco_lons_2d, ecco_lats_2d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Show the help for <code>pyresample.kdtree.resample_gauss</code> to aid during the hackathon.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">#help(resample_gauss)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Get the target grid definition defined by the 2d arrays of lons and lats created in the cell above. Apply gaussian resampling with some optional arguments (borrowed from Ian’s implementation).</p>
<div class="cell" data-execution_count="38">
<div class="sourceCode" id="cb65"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>result, stddev, counts <span class="op">=</span> resample_gauss(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    alt_grid_defn,      <span class="co"># source grid</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    ssha.values[nans],  <span class="co"># source data</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    ecco_grid_defn,     <span class="co"># target grid</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    radius_of_influence <span class="op">=</span> <span class="fl">1.75e5</span>,  </span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    sigmas              <span class="op">=</span> <span class="dv">25000</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    fill_value          <span class="op">=</span> np.nan, </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>    neighbours          <span class="op">=</span> <span class="dv">100</span>, </span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>    with_uncert         <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(result), <span class="bu">type</span>(stddev), <span class="bu">type</span>(counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="38">
<pre><code>(numpy.ndarray, numpy.ma.core.MaskedArray, numpy.ndarray)</code></pre>
</div>
</div>
<p>Apply the land/water mask in the numpy array created from the ECCO layer in the steps above. Then, convert the masked numpy array to an xarray data array object named <em>gridded</em>. Print its header.</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode" id="cb67"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>masked <span class="op">=</span> np.where(ecco_mask, result, np.nan)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>gridded <span class="op">=</span> xr.DataArray(masked, </span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>                       name<span class="op">=</span><span class="st">"ssha"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>                       dims<span class="op">=</span>[<span class="st">'latitude'</span>, <span class="st">'longitude'</span>], </span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>                       coords<span class="op">=</span>{<span class="st">'time'</span>: time, <span class="st">'longitude'</span>: ecco_lons, <span class="st">'latitude'</span>: ecco_lats})</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(gridded)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>&lt;xarray.DataArray 'ssha' (latitude: 360, longitude: 720)&gt;
array([[nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       ...,
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan],
       [nan, nan, nan, ..., nan, nan, nan]])
Coordinates:
    time       datetime64[ns] 2021-07-18T15:11:35.073955170
  * longitude  (longitude) float32 -179.8 -179.2 -178.8 ... 178.8 179.2 179.8
  * latitude   (latitude) float32 -89.75 -89.25 -88.75 ... 88.75 89.25 89.75</code></pre>
</div>
</div>
<div class="cell" data-execution_count="40">
<div class="sourceCode" id="cb69"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>gridded.sel(latitude<span class="op">=</span><span class="bu">slice</span>(<span class="op">-</span><span class="fl">70.0</span>, <span class="fl">70.0</span>)).plot.pcolormesh(vmin<span class="op">=-</span><span class="fl">0.4</span>, vmax<span class="op">=</span><span class="fl">0.4</span>, cmap<span class="op">=</span><span class="st">"jet"</span>, figsize<span class="op">=</span>(<span class="dv">18</span>,<span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="40">
<pre><code>&lt;matplotlib.collections.QuadMesh at 0x7f3157b58040&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="06_S6_OPeNDAP_Access_Gridding_files/figure-html/cell-41-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="41">
<div class="sourceCode" id="cb71"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>stddev <span class="op">=</span> xr.DataArray(np.where(ecco_mask, stddev, np.nan), </span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>                      name<span class="op">=</span><span class="st">"stddev"</span>,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>                      dims<span class="op">=</span>[<span class="st">'latitude'</span>, <span class="st">'longitude'</span>], </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>                      coords<span class="op">=</span>{<span class="st">'time'</span>: time, <span class="st">'longitude'</span>: ecco_lons, <span class="st">'latitude'</span>: ecco_lats})</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>stddev.sel(latitude<span class="op">=</span><span class="bu">slice</span>(<span class="op">-</span><span class="fl">70.0</span>, <span class="fl">70.0</span>)).plot.pcolormesh(vmax<span class="op">=</span><span class="fl">0.4</span>, cmap<span class="op">=</span><span class="st">"jet"</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="41">
<pre><code>&lt;matplotlib.collections.QuadMesh at 0x7f3157d7c640&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="06_S6_OPeNDAP_Access_Gridding_files/figure-html/cell-42-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="42">
<div class="sourceCode" id="cb73"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> xr.DataArray(np.where(ecco_mask, counts, np.nan), </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                      name<span class="op">=</span><span class="st">"counts"</span>,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                      dims<span class="op">=</span>[<span class="st">'latitude'</span>, <span class="st">'longitude'</span>], </span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>                      coords<span class="op">=</span>{<span class="st">'time'</span>: time, <span class="st">'longitude'</span>: ecco_lons, <span class="st">'latitude'</span>: ecco_lats})</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>counts.sel(latitude<span class="op">=</span><span class="bu">slice</span>(<span class="op">-</span><span class="fl">70.0</span>, <span class="fl">70.0</span>)).plot.pcolormesh(cmap<span class="op">=</span><span class="st">"jet"</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">7</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="42">
<pre><code>&lt;matplotlib.collections.QuadMesh at 0x7f31579966a0&gt;</code></pre>
</div>
<div class="cell-output-display">
<p><img src="06_S6_OPeNDAP_Access_Gridding_files/figure-html/cell-43-output-2.png" class="img-fluid"></p>
</div>
</div>
<p><strong>Additional References:</strong></p>
<ul>
<li><em>numpy</em> (https://numpy.org/doc/stable/reference)
<ul>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.data.html">numpy.ndarray.data</a><br>
</li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.ravel.html">numpy.ravel</a><br>
</li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.where.html">numpy.where</a><br>
</li>
<li><a href="https://numpy.org/doc/stable/reference/generated/numpy.isnan.html">numpy.isnan</a><br>
</li>
<li><a href="https://numpy.org/doc/stable/reference/arrays.datetime.html">datetimes</a><br>
</li>
</ul></li>
<li><em>xarray</em> (https://xarray.pydata.org/en/stable)
<ul>
<li><a href="https://xarray.pydata.org/en/stable/generated/xarray.DataArray.html">xarray.DataArray</a><br>
</li>
<li><a href="https://xarray.pydata.org/en/stable/generated/xarray.DataArray.values.html">xarray.DataArray.values</a><br>
</li>
<li><a href="https://xarray.pydata.org/en/stable/generated/xarray.DataArray.mean.html">xarray.DataArray.mean</a><br>
</li>
<li>https://xarray.pydata.org/en/stable/generated/xarray.DataArray.plot.pcolormesh.html (matplotlib)<br>
</li>
</ul></li>
<li><em>pyresample</em> (https://pyresample.readthedocs.io/en/latest/api/pyresample)
<ul>
<li><a href="https://pyresample.readthedocs.io/en/latest/api/pyresample.utils.html#pyresample.utils.check_and_wrap">pyresample.utils.check_and_wrap</a><br>
</li>
<li><a href="https://pyresample.readthedocs.io/en/latest/api/pyresample.html#pyresample.kd_tree.resample_gauss">pyresample.kd_tree.resample_gauss</a><br>
</li>
<li><a href="https://pyresample.readthedocs.io/en/latest/api/pyresample.html#pyresample.geometry.SwathDefinition">pyresample.geometry.SwathDefinition</a></li>
</ul></li>
</ul>
<p><strong>Bonus</strong>: generate a grid for every cycle and get mean/std over all the cycles</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>stack <span class="op">=</span> xr.concat(data[<span class="st">'grid'</span>].tolist(), dim<span class="op">=</span><span class="st">"time"</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>midlat <span class="op">=</span> stack.sel(latitude<span class="op">=</span><span class="bu">slice</span>(<span class="op">-</span><span class="fl">66.</span>,<span class="fl">66.0</span>))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> xr.concat(objs<span class="op">=</span>[midlat.mean(<span class="st">"time"</span>),</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                        midlat.std(<span class="st">"time"</span>) ], </span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                  dim<span class="op">=</span>pd.Index([<span class="st">'mean'</span>,<span class="st">'std'</span>], name<span class="op">=</span><span class="st">"stat"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>https://xarray.pydata.org/en/stable/generated/xarray.concat.html</p>
</blockquote>
<p><strong>Bonus</strong>: calculate area-weighted mean</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_area_weighted_mean(x):</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    nonzero_mask <span class="op">=</span> np.where(<span class="op">~</span>np.isnan(x), <span class="dv">1</span>, np.nan)            <span class="co"># mask where nans=0 &amp; ~nans=1</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>    nonzero_area <span class="op">=</span> np.<span class="bu">sum</span>(nonzero_mask <span class="op">*</span> ecco_grid.area)        <span class="co"># total area where data is nonzero</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">float</span>(np.nansum(x <span class="op">*</span> ecco_grid.area) <span class="op">/</span> nonzero_area)  <span class="co"># area-weighted global mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p>https://numpy.org/doc/stable/reference/generated/numpy.sum.html<br>
https://numpy.org/doc/stable/reference/generated/numpy.nansum.html</p>
</blockquote>


</section>
</section>
</section>
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('div.sidebar-toc .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
    } else {
      disableStylesheet(alternateStylesheets);
    }
    manageTransitions('.quarto-toc-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      return window.localStorage.getItem("quarto-color-scheme");
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = null;
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.id = "quarto-color-scheme-toggle";
    a.classList.add('top-right');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    window.tippy(el, {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    }); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</main>
<div class="page-navigation page-navigation-docked">
  <div class="nav-page nav-page-previous">
      <a href="../tutorials/05_Data_Access_Direct_S3.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">05. Direct S3 Data Access</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../tutorials/07_Data_Access_Harmony_Subsetting.html">
        <span class="nav-page-text">Data Subsetting and Transformation Services in the Cloud</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</div>
</div> <!-- /main column -->
</div> <!-- /row -->
<div class="row">
  <div class="nav-footer">
      <div class="nav-footer-center me-auto ms-auto">PODAAC, NSIDC DAAC and LPDAAC (2021). 2021 Cloud Hackathon</div>
  </div>
</div>
</div> <!-- /container fluid -->


</body></html>